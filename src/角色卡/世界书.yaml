# yaml-language-server: $schema=https://testingcf.jsdelivr.net/gh/StageDog/tavern_sync/dist/schema/character.zh.json
头像: 头像
版本: ""
作者: ""
备注: ""

第一条消息:
  - 内容: 【看到我说明你正则没开】
  - 文件: 第一条消息\1

角色描述: ""

锚点: {}

世界书名称: 请问您今天要来点兔子吗 v0.1-SNAPSHOT
条目:
  - 名称: AI回复格式
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 指定深度
      角色: 系统
      深度: 0
      顺序: 9997
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\AI回复格式

  - 名称: "[InitVar] 请勿开启"
    启用: false
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 0
    激活概率: 100
    递归:
      不可被其他条目激活: false
      不可激活其他条目: false
    文件: 世界书\[InitVar]_请勿开启

  - 名称: 当前变量
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 指定深度
      角色: 系统
      深度: 4
      顺序: 777
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\变量\当前变量

  - 名称: 变量更新规则
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 指定深度
      角色: 系统
      深度: 0
      顺序: 9998
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\变量\变量更新规则

  - 名称: 变量输出格式
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 指定深度
      角色: 系统
      深度: 0
      顺序: 9999
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\变量\变量输出格式

  - 名称: 语料开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之后
      顺序: 33
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料开始

  - 名称: 世界观开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 0
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\世界观开始

  - 名称: 语料-保登心爱
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 心爱
        - 保登
        - Rabbit House
    插入位置:
      类型: 角色定义之后
      顺序: 34
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-保登心爱

  - 名称: 大世界观之木结构小镇
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 1
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\大世界观之木结构小镇

  - 名称: 语料-香风智乃
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 智乃
        - 香风
        - Rabbit House
    插入位置:
      类型: 角色定义之后
      顺序: 35
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-香风智乃

  - 名称: 角色总览
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 2
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    内容: |
      ---
      主要角色: | # 故事中的核心人物
        保登心爱
        香风智乃
        天天座理世
        宇治松千夜
        桐间纱路
        条河麻耶
        奈津惠

      重要配角: | # 频繁参与主要剧情，或有显著意义的人物
        风衣叶冬优
        神沙夏明
        神沙映月
        狩手结良
        青山蓝山
        真手凛
        保登摩卡

      兔子们: | # 就是兔子
        提比
        豆馅
        野雁

      一般配角: | # 很少参与主要剧情的人物
        香风隆宏
        香风咲
        保登千代子
        理世的父亲
        千夜的奶奶
        其他家属
        心爱的同学
        Royal Cats相关人士

  - 名称: 语料-天天座理世
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 理世
        - Rabbit House
    插入位置:
      类型: 角色定义之后
      顺序: 36
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-天天座理世

  - 名称: 世界观结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 3
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\世界观结束

  - 名称: 语料-宇治松千夜
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 千夜
        - 甘兔庵
    插入位置:
      类型: 角色定义之后
      顺序: 37
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-宇治松千夜

  - 名称: 主要角色开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 4
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\主要角色开始

  - 名称: 语料-桐间纱路
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 纱路
        - Fleur de Lapin
    插入位置:
      类型: 角色定义之后
      顺序: 38
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-桐间纱路

  - 名称: 保登心爱
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 心爱
        - 保登
        - Rabbit House
    插入位置:
      类型: 角色定义之前
      顺序: 5
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\保登心爱

  - 名称: 语料-条河麻耶
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 麻耶
    插入位置:
      类型: 角色定义之后
      顺序: 39
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-条河麻耶

  - 名称: 香风智乃
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 智乃
        - 香风
        - Rabbit House
        - 小豆队
    插入位置:
      类型: 角色定义之前
      顺序: 6
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\香风智乃

  - 名称: 语料-奈津惠
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 小惠
    插入位置:
      类型: 角色定义之后
      顺序: 40
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料-奈津惠

  - 名称: 天天座理世
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 理世
        - 萝世
        - Rabbit House
    插入位置:
      类型: 角色定义之前
      顺序: 7
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\天天座理世

  - 名称: 语料结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之后
      顺序: 60
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\语料结束

  - 名称: 宇治松千夜
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 千夜
        - 甘兔庵
    插入位置:
      类型: 角色定义之前
      顺序: 8
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\宇治松千夜

  - 名称: 桐间纱路
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 纱路
        - Fleur de Lapin
    插入位置:
      类型: 角色定义之前
      顺序: 9
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\桐间纱路

  - 名称: 条河麻耶
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 麻耶
        - 小豆队
        - 豆苗队
    插入位置:
      类型: 角色定义之前
      顺序: 10
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\条河麻耶

  - 名称: 奈津惠
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 小惠
        - 小豆队
        - 豆苗队
    插入位置:
      类型: 角色定义之前
      顺序: 11
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\奈津惠

  - 名称: 主要角色结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 12
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\主要角色结束

  - 名称: 重要配角开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 13
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\重要配角开始

  - 名称: 青山蓝山
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 青山
        - 小说
        - 小翠
        - 祖母绿小姐
    插入位置:
      类型: 角色定义之前
      顺序: 14
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\青山蓝山

  - 名称: 真手凛
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 凛
        - 青山
    插入位置:
      类型: 角色定义之前
      顺序: 15
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\真手凛

  - 名称: 保登摩卡
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 保登
        - 摩卡
    插入位置:
      类型: 角色定义之前
      顺序: 16
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\保登摩卡

  - 名称: 狩手结良
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 结良
        - 女仆
        - Bright Bunny
    插入位置:
      类型: 角色定义之前
      顺序: 17
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\狩手结良

  - 名称: 风衣叶冬优
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 冬优
        - Bright Bunny
    插入位置:
      类型: 角色定义之前
      顺序: 18
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\风衣叶冬优

  - 名称: 神沙夏明
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 神沙
        - 夏明
        - 豆苗队
        - Bright Bunny
    插入位置:
      类型: 角色定义之前
      顺序: 19
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\神沙夏明

  - 名称: 神沙映月
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 神沙
        - 映月
        - 豆苗队
        - Bright Bunny
    插入位置:
      类型: 角色定义之前
      顺序: 20
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\神沙映月

  - 名称: 重要配角结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 21
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\重要配角结束

  - 名称: 兔子开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 22
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\兔子开始

  - 名称: 提比
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 提比
        - 爷爷
        - Rabbit House
    插入位置:
      类型: 角色定义之前
      顺序: 23
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\提比

  - 名称: 豆馅
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 豆馅
        - 甘兔庵
    插入位置:
      类型: 角色定义之前
      顺序: 24
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\豆馅

  - 名称: 野雁
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 野雁
        - 纱路
    插入位置:
      类型: 角色定义之前
      顺序: 25
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\野雁

  - 名称: 兔子结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 26
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\兔子结束

  - 名称: 次要配角开始
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 27
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\次要配角开始

  - 名称: 香风隆宏
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 香风
        - Rabbit House
        - 隆宏
    插入位置:
      类型: 角色定义之前
      顺序: 28
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\香风隆宏

  - 名称: 香风咲
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 香风
        - 咲
    插入位置:
      类型: 角色定义之前
      顺序: 29
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\香风咲

  - 名称: 其他家属
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 家人
        - 亲人
        - 家族
        - 父亲
        - 母亲
        - 爸爸
        - 妈妈
        - 哥哥
        - 奶奶
        - 家属
    插入位置:
      类型: 角色定义之前
      顺序: 30
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\其他家属

  - 名称: NPC中的NPC
    启用: true
    激活策略:
      类型: 绿灯
      关键字:
        - 同学
        - 店长
        - Royal Cats
        - 诺瓦
    插入位置:
      类型: 角色定义之前
      顺序: 31
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\NPC中的NPC

  - 名称: 次要配角结束
    启用: true
    激活策略:
      类型: 蓝灯
    插入位置:
      类型: 角色定义之前
      顺序: 32
    激活概率: 100
    递归:
      不可被其他条目激活: true
      不可激活其他条目: true
    文件: 世界书\次要配角结束

扩展字段:
  正则:
    - 正则名称: 前端
      id: 6d422803-409b-439b-90a4-e07cec1d8d94
      启用: true
      查找表达式: /.+/s
      文件: 正则\前端
      来源:
        用户输入: true
        AI输出: true
      作用于:
        仅格式显示: true
        仅格式提示词: false

  酒馆助手:
    脚本库:
      - 名称: MVU
        id: e2825cb2-b310-4f2a-aaf9-ab921b6f7f9f
        启用: true
        类型: 脚本
        内容: |
          import 'https://testingcf.jsdelivr.net/gh/MagicalAstrogy/MagVarUpdate/artifact/bundle.js';
        按钮:
          启用: true
          按钮列表:
            - 名称: 重新处理变量
              可见: false
            - 名称: 重新读取初始变量
              可见: false
            - 名称: 快照楼层
              可见: false
            - 名称: 重演楼层
              可见: false
            - 名称: 重试额外模型解析
              可见: false
            - 名称: 清除旧楼层变量
              可见: false

      - 名称: 变量模式注册
        id: f2a4fb3b-9d58-4442-a047-db50d78106a6
        启用: true
        类型: 脚本
        内容: |
          import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';

          export const Schema = z.object({
            世界: z.object({
              当前时间: z.string().describe('%M-%d %H:%i'),
              当前地点: z.string(),
              当前季节: z.enum(['春', '夏', '秋', '冬']),
              当前天气: z.string(),
              近期事务: z.record(z.string().describe('事务名'), z.string().describe('事务描述')),
            }),

            _主视角: z.enum(['无', '保登心爱', '香风智乃', '天天座理世', '宇治松千夜', '桐间纱路']),

            当前场景角色: z.array(z.string()),

            保登心爱: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            香风智乃: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            天天座理世: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            宇治松千夜: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            桐间纱路: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            条河麻耶: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            奈津惠: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            风衣叶冬优: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            神沙夏明: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            神沙映月: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            狩手结良: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            青山蓝山: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            真手凛: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            保登摩卡: z.object({
              当前位置: z.string(),
              心情状态: z.string(),
              着装: z.string(),
              关键物品: z
                .record(
                  z.string().describe('物品名'),
                  z.object({
                    描述: z.string(),
                    数量: z.coerce.number(),
                  }),
                )
                .transform(data => _.pickBy(data, ({ 数量 }) => 数量 > 0)),
            }),

            店铺人气: z.object({
              'Rabbit House': z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              甘兔庵: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              'Fleur de Lapin': z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              'Bright Bunny': z.coerce.number().transform(v => _.clamp(v, 0, 100)),
            }),
          });

          $(() => {
            registerMvuSchema(Schema);
          });

    变量: {}

  xiaobaix-tasks:
    tasks: []
