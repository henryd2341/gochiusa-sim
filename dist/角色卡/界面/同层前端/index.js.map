{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/角色卡/界面/同层前端/stores/characterStore.ts","src://tavern_helper_template/src/角色卡/界面/同层前端/stores/gameStore.ts","src://tavern_helper_template/src/角色卡/界面/同层前端/stores/settingsStore.ts","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/MessageDisplay.vue?4809","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/MessageDisplay.vue?acba","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/OptionsPanel.vue?0a20","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/OptionsPanel.vue?92dd","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/GameMain.vue?fc65","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/GameMain.vue?c24f","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/HistoryMessages.vue?e673","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/HistoryMessages.vue?927d","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/SettingsPage.vue?ecab","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/SettingsPage.vue?3136","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/StartScreen.vue?d0e6","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/StartScreen.vue?2b8e","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/pinia/+esm\"","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/vue-router/+esm\"","src://tavern_helper_template/external module \"https://testingcf.jsdelivr.net/npm/vue/+esm\"","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/components/TopNavBar.vue?ffc0","webpack://tavern_helper_template/src/角色卡/界面/同层前端/components/TopNavBar.vue?416f","webpack://tavern_helper_template/./src/角色卡/界面/同层前端/App.vue?3a2a","webpack://tavern_helper_template/src/角色卡/界面/同层前端/App.vue?f2cb","src://tavern_helper_template/src/角色卡/界面/同层前端/index.ts"],"sourcesContent":["import { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nexport interface MvuStatData extends Record<string, unknown> {\n  当前场景角色?: string[];\n  _主视角?: string;\n  世界?: Record<string, unknown>;\n}\n\nfunction resolveMessageId(input?: number): number {\n  if (typeof input === 'number' && Number.isFinite(input) && input >= 0) return input;\n  const latest = getLastMessageId();\n  return latest >= 0 ? latest : 0;\n}\n\nfunction toStatData(value: unknown): MvuStatData | null {\n  if (typeof value === 'object' && value !== null) return value as MvuStatData;\n  return null;\n}\n\nexport const useCharacterStore = defineStore('gochiusa-character-v3', () => {\n  const isReady = ref(false);\n  const mvuData = ref<MvuStatData | null>(null);\n\n  async function initialize(messageId?: number) {\n    if (!isReady.value) {\n      await waitGlobalInitialized('Mvu');\n      isReady.value = true;\n    }\n    await refresh(messageId);\n  }\n\n  async function refresh(messageId?: number) {\n    if (!isReady.value) {\n      await waitGlobalInitialized('Mvu');\n      isReady.value = true;\n    }\n\n    try {\n      const data = Mvu.getMvuData({ type: 'message', message_id: resolveMessageId(messageId) });\n      mvuData.value = toStatData(data?.stat_data);\n    } catch (error) {\n      console.warn('[同层前端_v3] 读取 MVU 数据失败:', error);\n      mvuData.value = null;\n    }\n  }\n\n  function getCurrentSceneCharacters(): string[] {\n    const names = mvuData.value?.当前场景角色;\n    return Array.isArray(names) ? names : [];\n  }\n\n  return {\n    isReady,\n    mvuData,\n    initialize,\n    refresh,\n    getCurrentSceneCharacters,\n  };\n});\n","import { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nexport interface RoleplayOption {\n  id: string;\n  title: string;\n  content: string;\n  isCustom?: boolean;\n}\n\nconst POV_STORAGE_KEY = 'gochiusa-sim.pov.v3';\n\nconst POV_OPENING_MAP: Record<string, string> = {\n  保登心爱:\n    '【开场】清晨的 Rabbit House 弥漫着新烘焙咖啡的香气。你推门而入，心爱正在柜台后朝你挥手，今天的故事从这一刻开始。',\n  香风智乃: '【开场】咖啡杯沿升起细白热气。你安静地坐下，智乃把菜单轻轻推到你面前，视线在你与窗外晨光之间短暂停留。',\n  天天座理世:\n    '【开场】门铃清脆作响。理世利落地整理着围裙与杯具，向你点头示意。今天的每一步选择，都会让日常偏离原有轨道。',\n  宇治松千夜: '【开场】和风甜点的香气从柜台另一侧飘来。千夜眯着眼微笑，把刚出炉的点心摆上托盘，邀请你参与今天的安排。',\n  桐间纱路:\n    '【开场】你刚落座，纱路已经把账本与托盘分门别类地摆好。她装作镇定地抬头，语速比平时略快地向你说明今天的计划。',\n};\n\nconst DEFAULT_POV = '保登心爱';\n\nfunction loadPov(): string | null {\n  try {\n    const value = localStorage.getItem(POV_STORAGE_KEY);\n    return typeof value === 'string' && value.length > 0 ? value : null;\n  } catch {\n    return null;\n  }\n}\n\nexport const useGameStore = defineStore('gochiusa-game-v3', () => {\n  const currentMessage = ref('');\n  const currentMessageId = ref(-1);\n  const options = ref<RoleplayOption[]>([]);\n  const isGenerating = ref(false);\n  const isLoading = ref(false);\n  const selectedPov = ref<string | null>(loadPov());\n\n  function setMessage(message: string, messageId: number) {\n    currentMessage.value = message;\n    currentMessageId.value = messageId;\n  }\n\n  function setOptions(next: RoleplayOption[]) {\n    options.value = next;\n  }\n\n  function setGenerating(value: boolean) {\n    isGenerating.value = value;\n  }\n\n  function setLoading(value: boolean) {\n    isLoading.value = value;\n  }\n\n  function setPov(pov: string) {\n    selectedPov.value = pov;\n    try {\n      localStorage.setItem(POV_STORAGE_KEY, pov);\n    } catch {\n      // ignore storage write failure in sandboxed iframe\n    }\n  }\n\n  function getOpeningLine() {\n    const pov = selectedPov.value ?? DEFAULT_POV;\n    return POV_OPENING_MAP[pov] ?? POV_OPENING_MAP[DEFAULT_POV];\n  }\n\n  function listAvailablePov() {\n    return Object.keys(POV_OPENING_MAP);\n  }\n\n  return {\n    currentMessage,\n    currentMessageId,\n    options,\n    isGenerating,\n    isLoading,\n    selectedPov,\n    setMessage,\n    setOptions,\n    setGenerating,\n    setLoading,\n    setPov,\n    getOpeningLine,\n    listAvailablePov,\n  };\n});\n","import { defineStore } from 'pinia';\nimport { ref, watch } from 'vue';\n\nexport type ThemeMode = 'warm' | 'cool' | 'high-contrast' | 'eye-care';\nexport type FontScheme = 'default' | 'reading' | 'artistic';\nexport type FontSize = 'small' | 'medium' | 'large';\n\nexport interface UiSettings {\n  theme: ThemeMode;\n  fontScheme: FontScheme;\n  fontSize: FontSize;\n}\n\nconst STORAGE_KEY = 'gochiusa-sim.ui-settings.v3';\n\nconst defaultSettings: UiSettings = {\n  theme: 'warm',\n  fontScheme: 'default',\n  fontSize: 'medium',\n};\n\nfunction parseSettings(raw: string | null): UiSettings {\n  if (!raw) return { ...defaultSettings };\n\n  try {\n    const parsed = JSON.parse(raw) as Partial<UiSettings>;\n    return {\n      theme:\n        parsed.theme === 'warm' ||\n        parsed.theme === 'cool' ||\n        parsed.theme === 'high-contrast' ||\n        parsed.theme === 'eye-care'\n          ? parsed.theme\n          : defaultSettings.theme,\n      fontScheme:\n        parsed.fontScheme === 'default' || parsed.fontScheme === 'reading' || parsed.fontScheme === 'artistic'\n          ? parsed.fontScheme\n          : defaultSettings.fontScheme,\n      fontSize:\n        parsed.fontSize === 'small' || parsed.fontSize === 'medium' || parsed.fontSize === 'large'\n          ? parsed.fontSize\n          : defaultSettings.fontSize,\n    };\n  } catch {\n    return { ...defaultSettings };\n  }\n}\n\nexport const useSettingsStore = defineStore('gochiusa-settings-v3', () => {\n  const settings = ref<UiSettings>(parseSettings(localStorage.getItem(STORAGE_KEY)));\n\n  function updateSettings(next: Partial<UiSettings>) {\n    settings.value = { ...settings.value, ...next };\n  }\n\n  function resetSettings() {\n    settings.value = { ...defaultSettings };\n  }\n\n  watch(\n    settings,\n    value => {\n      try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(value));\n      } catch {\n        // ignore storage write failures in sandboxed iframe\n      }\n    },\n    { deep: true },\n  );\n\n  return {\n    settings,\n    updateSettings,\n    resetSettings,\n  };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"card message-display\" };\nconst _hoisted_2 = { class: \"head\" };\nconst _hoisted_3 = { class: \"content\" };\nimport { computed } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'MessageDisplay',\n    props: {\n        message: {},\n        messageId: {}\n    },\n    setup(__props) {\n        const props = __props;\n        const message = computed(() => props.message);\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createElementVNode(\"header\", _hoisted_2, [\n                    _cache[0] || (_cache[0] = _createElementVNode(\"strong\", null, \"当前楼层：\", -1 /* CACHED */)),\n                    _createElementVNode(\"span\", null, _toDisplayString(__props.messageId >= 0 ? `#${__props.messageId}` : '暂无'), 1 /* TEXT */)\n                ]),\n                _createElementVNode(\"article\", _hoisted_3, _toDisplayString(message.value), 1 /* TEXT */)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./MessageDisplay.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./MessageDisplay.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./MessageDisplay.vue?vue&type=style&index=0&id=43de0948&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-43de0948\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, vModelText as _vModelText, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = { class: \"card options-panel\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"empty\"\n};\nconst _hoisted_3 = {\n    key: 1,\n    class: \"list\"\n};\nconst _hoisted_4 = [\"disabled\", \"onClick\"];\nconst _hoisted_5 = { class: \"title\" };\nconst _hoisted_6 = { class: \"content\" };\nconst _hoisted_7 = { class: \"custom-row\" };\nconst _hoisted_8 = [\"disabled\"];\nimport { ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'OptionsPanel',\n    props: {\n        options: {},\n        disabled: { type: Boolean }\n    },\n    emits: [\"select\"],\n    setup(__props, { emit: __emit }) {\n        const props = __props;\n        const emit = __emit;\n        const customText = ref('');\n        function emitSelect(option) {\n            emit('select', option);\n        }\n        function submitCustom() {\n            const text = customText.value;\n            if (!text)\n                return;\n            emit('select', {\n                id: `custom-${Date.now()}`,\n                title: '自定义行动',\n                content: text,\n                isCustom: true,\n            });\n            customText.value = '';\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _cache[1] || (_cache[1] = _createElementVNode(\"header\", { class: \"head\" }, [\n                    _createElementVNode(\"strong\", null, \"可选行动\")\n                ], -1 /* CACHED */)),\n                (__props.options.length === 0)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"当前消息未解析出选项\"))\n                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.options, (item) => {\n                            return (_openBlock(), _createElementBlock(\"button\", {\n                                key: item.id,\n                                class: \"option-btn\",\n                                disabled: __props.disabled,\n                                onClick: ($event) => (emitSelect(item))\n                            }, [\n                                _createElementVNode(\"span\", _hoisted_5, _toDisplayString(item.title), 1 /* TEXT */),\n                                _createElementVNode(\"span\", _hoisted_6, _toDisplayString(item.content), 1 /* TEXT */)\n                            ], 8 /* PROPS */, _hoisted_4));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])),\n                _createElementVNode(\"div\", _hoisted_7, [\n                    _withDirectives(_createElementVNode(\"input\", {\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((customText).value = $event)),\n                        class: \"custom-input\",\n                        placeholder: \"输入自定义行动内容\"\n                    }, null, 512 /* NEED_PATCH */), [\n                        [\n                            _vModelText,\n                            customText.value,\n                            void 0,\n                            { trim: true }\n                        ]\n                    ]),\n                    _createElementVNode(\"button\", {\n                        class: \"custom-btn\",\n                        disabled: __props.disabled || !customText.value,\n                        onClick: submitCustom\n                    }, \"发送\", 8 /* PROPS */, _hoisted_8)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./OptionsPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./OptionsPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./OptionsPanel.vue?vue&type=style&index=0&id=17d36e64&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-17d36e64\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"meta card\" };\nconst _hoisted_2 = [\"disabled\"];\nimport { computed, onMounted, onUnmounted } from 'vue';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useGameStore } from '../stores/gameStore';\nimport MessageDisplay from './MessageDisplay.vue';\nimport OptionsPanel from './OptionsPanel.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'GameMain',\n    setup(__props) {\n        const gameStore = useGameStore();\n        const characterStore = useCharacterStore();\n        const sceneCharactersText = computed(() => {\n            const list = characterStore.getCurrentSceneCharacters();\n            return list.length > 0 ? list.join(' / ') : '无';\n        });\n        function isAssistantMessageLike(value) {\n            return (typeof value === 'object' &&\n                value !== null &&\n                'message_id' in value &&\n                'message' in value &&\n                typeof value.message_id === 'number' &&\n                typeof value.message === 'string');\n        }\n        function parseOptionsFromMessage(message) {\n            const block = message.match(/<roleplay_options>([\\s\\S]*?)<\\/roleplay_options>/i);\n            if (!block)\n                return [];\n            const lines = block[1]\n                .split('\\n')\n                .map(line => line.trim())\n                .filter(Boolean);\n            const options = [];\n            for (let i = 0; i < lines.length; i += 1) {\n                const line = lines[i];\n                const matched = line.match(/^(.+?)[:：]\\s*(.+)$/);\n                if (!matched)\n                    continue;\n                options.push({\n                    id: `opt-${i}-${Date.now()}`,\n                    title: matched[1].trim(),\n                    content: matched[2]\n                        .trim()\n                        .replace(/^「(.+)」$/, '$1')\n                        .replace(/^\\$\\{(.+)\\}$/, '$1'),\n                });\n            }\n            return options;\n        }\n        async function loadLatestAssistantMessage() {\n            const latestId = getLastMessageId();\n            if (latestId < 0) {\n                gameStore.setMessage(gameStore.getOpeningLine(), 0);\n                gameStore.setOptions([]);\n                return;\n            }\n            let current;\n            for (let id = latestId; id >= 0; id -= 1) {\n                const messages = getChatMessages(id, { role: 'assistant', hide_state: 'all' });\n                const candidate = messages[0];\n                if (isAssistantMessageLike(candidate)) {\n                    current = candidate;\n                    break;\n                }\n            }\n            if (!current) {\n                gameStore.setMessage(gameStore.getOpeningLine(), 0);\n                gameStore.setOptions([]);\n                return;\n            }\n            if (current.message_id === 0) {\n                gameStore.setMessage(gameStore.getOpeningLine(), 0);\n                gameStore.setOptions([]);\n                return;\n            }\n            gameStore.setMessage(current.message, current.message_id);\n            gameStore.setOptions(parseOptionsFromMessage(current.message));\n        }\n        async function refreshAll() {\n            gameStore.setLoading(true);\n            try {\n                await characterStore.refresh();\n                await loadLatestAssistantMessage();\n            }\n            finally {\n                gameStore.setLoading(false);\n            }\n        }\n        async function handleSelect(option) {\n            if (gameStore.isGenerating)\n                return;\n            gameStore.setGenerating(true);\n            try {\n                await createChatMessages([\n                    {\n                        role: 'user',\n                        message: option.content,\n                    },\n                ]);\n                await triggerSlash('/trigger');\n                await refreshAll();\n            }\n            catch (error) {\n                console.error('[同层前端_v3] 发送选项失败:', error);\n            }\n            finally {\n                gameStore.setGenerating(false);\n            }\n        }\n        let stopRendered = null;\n        onMounted(async () => {\n            await characterStore.initialize();\n            await refreshAll();\n            stopRendered = eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED, async () => {\n                await refreshAll();\n            });\n        });\n        onUnmounted(() => {\n            stopRendered?.stop();\n            stopRendered = null;\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", null, [\n                _createVNode(MessageDisplay, {\n                    message: _unref(gameStore).currentMessage,\n                    \"message-id\": _unref(gameStore).currentMessageId\n                }, null, 8 /* PROPS */, [\"message\", \"message-id\"]),\n                _createVNode(OptionsPanel, {\n                    options: _unref(gameStore).options,\n                    disabled: _unref(gameStore).isGenerating,\n                    onSelect: handleSelect\n                }, null, 8 /* PROPS */, [\"options\", \"disabled\"]),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", null, \"主视角：\" + _toDisplayString(_unref(gameStore).selectedPov ?? _unref(characterStore).mvuData?._主视角 ?? '未知'), 1 /* TEXT */),\n                    _createElementVNode(\"div\", null, \"当前场景角色：\" + _toDisplayString(sceneCharactersText.value), 1 /* TEXT */),\n                    _createElementVNode(\"button\", {\n                        class: \"refresh-btn\",\n                        disabled: _unref(gameStore).isLoading,\n                        onClick: refreshAll\n                    }, _toDisplayString(_unref(gameStore).isLoading ? '刷新中...' : '刷新消息'), 9 /* TEXT, PROPS */, _hoisted_2)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./GameMain.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./GameMain.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./GameMain.vue?vue&type=style&index=0&id=59ed0d1d&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-59ed0d1d\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = { class: \"card history\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"empty\"\n};\nconst _hoisted_3 = {\n    key: 1,\n    class: \"list\"\n};\nconst _hoisted_4 = [\"onClick\"];\nconst _hoisted_5 = { class: \"preview\" };\nimport { computed, onMounted, ref } from 'vue';\nimport { useRouter } from 'vue-router';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'HistoryMessages',\n    setup(__props) {\n        const router = useRouter();\n        const rows = ref([]);\n        const keyword = ref('');\n        const filtered = computed(() => {\n            const key = keyword.value.toLowerCase();\n            if (!key)\n                return rows.value;\n            return rows.value.filter(item => item.message.toLowerCase().includes(key));\n        });\n        async function reload() {\n            const lastId = getLastMessageId();\n            const next = [];\n            for (let i = lastId; i >= 0; i -= 1) {\n                const found = getChatMessages(i, { hide_state: 'all' })[0];\n                if (!found?.message)\n                    continue;\n                next.push({\n                    message_id: found.message_id,\n                    role: found.role,\n                    message: found.message,\n                });\n                if (next.length >= 80)\n                    break;\n            }\n            rows.value = next;\n        }\n        async function jumpTo(messageId) {\n            try {\n                await triggerSlash(`/chat-jump ${messageId}`);\n            }\n            catch (error) {\n                console.warn('[同层前端_v3] 历史跳转失败:', error);\n            }\n            await router.push('/game');\n        }\n        onMounted(async () => {\n            await reload();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createElementVNode(\"header\", { class: \"head\" }, [\n                    _cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \"历史消息\", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"btn\",\n                        onClick: reload\n                    }, \"刷新\")\n                ]),\n                _withDirectives(_createElementVNode(\"input\", {\n                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((keyword).value = $event)),\n                    class: \"search\",\n                    placeholder: \"搜索消息内容...\"\n                }, null, 512 /* NEED_PATCH */), [\n                    [\n                        _vModelText,\n                        keyword.value,\n                        void 0,\n                        { trim: true }\n                    ]\n                ]),\n                (filtered.value.length === 0)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"暂无匹配消息\"))\n                    : (_openBlock(), _createElementBlock(\"ul\", _hoisted_3, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(filtered.value, (item) => {\n                            return (_openBlock(), _createElementBlock(\"li\", {\n                                key: item.message_id,\n                                class: \"item\"\n                            }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"jump\",\n                                    onClick: ($event) => (jumpTo(item.message_id))\n                                }, \"#\" + _toDisplayString(item.message_id) + \" · \" + _toDisplayString(item.role), 9 /* TEXT, PROPS */, _hoisted_4),\n                                _createElementVNode(\"p\", _hoisted_5, _toDisplayString(item.message), 1 /* TEXT */)\n                            ]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ]))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./HistoryMessages.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./HistoryMessages.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./HistoryMessages.vue?vue&type=style&index=0&id=b25c270c&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-b25c270c\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"card settings\" };\nconst _hoisted_2 = { class: \"group\" };\nconst _hoisted_3 = [\"value\"];\nconst _hoisted_4 = { class: \"group\" };\nconst _hoisted_5 = [\"value\"];\nconst _hoisted_6 = { class: \"group\" };\nconst _hoisted_7 = [\"value\"];\nimport { computed } from 'vue';\nimport { useSettingsStore } from '../stores/settingsStore';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'SettingsPage',\n    setup(__props) {\n        const settingsStore = useSettingsStore();\n        const settings = computed(() => settingsStore.settings);\n        function onThemeChange(event) {\n            const value = event.target.value;\n            settingsStore.updateSettings({ theme: value });\n        }\n        function onFontChange(event) {\n            const value = event.target.value;\n            settingsStore.updateSettings({ fontScheme: value });\n        }\n        function onSizeChange(event) {\n            const value = event.target.value;\n            settingsStore.updateSettings({ fontSize: value });\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _cache[7] || (_cache[7] = _createElementVNode(\"h2\", null, \"基础设置\", -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[2] || (_cache[2] = _createElementVNode(\"label\", null, \"主题\", -1 /* CACHED */)),\n                    _createElementVNode(\"select\", {\n                        value: settings.value.theme,\n                        onChange: onThemeChange\n                    }, [...(_cache[1] || (_cache[1] = [\n                            _createElementVNode(\"option\", { value: \"warm\" }, \"暖色\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"cool\" }, \"冷色\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"high-contrast\" }, \"高对比\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"eye-care\" }, \"护眼\", -1 /* CACHED */)\n                        ]))], 40 /* PROPS, NEED_HYDRATION */, _hoisted_3)\n                ]),\n                _createElementVNode(\"div\", _hoisted_4, [\n                    _cache[4] || (_cache[4] = _createElementVNode(\"label\", null, \"字体方案\", -1 /* CACHED */)),\n                    _createElementVNode(\"select\", {\n                        value: settings.value.fontScheme,\n                        onChange: onFontChange\n                    }, [...(_cache[3] || (_cache[3] = [\n                            _createElementVNode(\"option\", { value: \"default\" }, \"默认\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"reading\" }, \"阅读\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"artistic\" }, \"艺术\", -1 /* CACHED */)\n                        ]))], 40 /* PROPS, NEED_HYDRATION */, _hoisted_5)\n                ]),\n                _createElementVNode(\"div\", _hoisted_6, [\n                    _cache[6] || (_cache[6] = _createElementVNode(\"label\", null, \"字号\", -1 /* CACHED */)),\n                    _createElementVNode(\"select\", {\n                        value: settings.value.fontSize,\n                        onChange: onSizeChange\n                    }, [...(_cache[5] || (_cache[5] = [\n                            _createElementVNode(\"option\", { value: \"small\" }, \"小\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"medium\" }, \"中\", -1 /* CACHED */),\n                            _createElementVNode(\"option\", { value: \"large\" }, \"大\", -1 /* CACHED */)\n                        ]))], 40 /* PROPS, NEED_HYDRATION */, _hoisted_7)\n                ]),\n                _createElementVNode(\"button\", {\n                    class: \"reset-btn\",\n                    onClick: _cache[0] || (_cache[0] =\n                        //@ts-ignore\n                        (...args) => (_unref(settingsStore).resetSettings && _unref(settingsStore).resetSettings(...args)))\n                }, \"恢复默认\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./SettingsPage.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./SettingsPage.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./SettingsPage.vue?vue&type=style&index=0&id=0d5715f9&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0d5715f9\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelRadio as _vModelRadio, withDirectives as _withDirectives, toDisplayString as _toDisplayString, unref as _unref } from \"vue\";\nconst _hoisted_1 = { class: \"card start\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"pov card\"\n};\nconst _hoisted_3 = [\"value\"];\nconst _hoisted_4 = {\n    key: 1,\n    class: \"hint done\"\n};\nconst _hoisted_5 = [\"disabled\"];\nimport { computed, ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { useCharacterStore } from '../stores/characterStore';\nimport { useGameStore } from '../stores/gameStore';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'StartScreen',\n    setup(__props) {\n        const router = useRouter();\n        const characterStore = useCharacterStore();\n        const gameStore = useGameStore();\n        const isLoading = ref(false);\n        const isFirstRun = computed(() => !gameStore.selectedPov);\n        const povOptions = computed(() => gameStore.listAvailablePov());\n        const pendingPov = ref(gameStore.selectedPov ?? gameStore.listAvailablePov()[0] ?? '保登心爱');\n        async function handleStart() {\n            if (isLoading.value)\n                return;\n            isLoading.value = true;\n            try {\n                if (isFirstRun.value) {\n                    gameStore.setPov(pendingPov.value);\n                }\n                await characterStore.initialize();\n                await router.push('/game');\n            }\n            catch (error) {\n                console.error('[同层前端_v3] 启动页初始化失败:', error);\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _cache[3] || (_cache[3] = _createElementVNode(\"h1\", null, \"点兔同层前端 v3\", -1 /* CACHED */)),\n                _cache[4] || (_cache[4] = _createElementVNode(\"p\", null, \"先初始化 MVU 与消息状态，再进入主界面。\", -1 /* CACHED */)),\n                (isFirstRun.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \"主视角\", -1 /* CACHED */)),\n                        _cache[2] || (_cache[2] = _createElementVNode(\"p\", { class: \"hint\" }, \"首次进入请选择主视角，开场白将按该视角确定。\", -1 /* CACHED */)),\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(povOptions.value, (name) => {\n                            return (_openBlock(), _createElementBlock(\"label\", {\n                                key: name,\n                                class: \"pov-item\"\n                            }, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((pendingPov).value = $event)),\n                                    type: \"radio\",\n                                    value: name\n                                }, null, 8 /* PROPS */, _hoisted_3), [\n                                    [_vModelRadio, pendingPov.value]\n                                ]),\n                                _createElementVNode(\"span\", null, _toDisplayString(name), 1 /* TEXT */)\n                            ]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ]))\n                    : (_openBlock(), _createElementBlock(\"p\", _hoisted_4, \"已记住主视角：\" + _toDisplayString(_unref(gameStore).selectedPov), 1 /* TEXT */)),\n                _createElementVNode(\"button\", {\n                    class: \"start-btn\",\n                    disabled: isLoading.value,\n                    onClick: handleStart\n                }, _toDisplayString(isLoading.value ? '初始化中...' : 'Press Start'), 9 /* TEXT, PROPS */, _hoisted_5)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./StartScreen.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./StartScreen.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./StartScreen.vue?vue&type=style&index=0&id=382a9dac&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-382a9dac\"]])\n\nexport default __exports__","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = x({ [\"createPinia\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__.createPinia), [\"defineStore\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__.defineStore) });","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = x({ [\"createMemoryHistory\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_router_esm_7a560a22__.createMemoryHistory), [\"createRouter\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_router_esm_7a560a22__.createRouter), [\"useRoute\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_router_esm_7a560a22__.useRoute), [\"useRouter\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_router_esm_7a560a22__.useRouter) });","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = x({ [\"Fragment\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.Fragment), [\"computed\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.computed), [\"createApp\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createApp), [\"createBlock\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createBlock), [\"createCommentVNode\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createCommentVNode), [\"createElementBlock\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createElementBlock), [\"createElementVNode\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createElementVNode), [\"createVNode\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.createVNode), [\"defineComponent\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.defineComponent), [\"onMounted\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.onMounted), [\"onUnmounted\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.onUnmounted), [\"openBlock\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.openBlock), [\"ref\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.ref), [\"renderList\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.renderList), [\"resolveComponent\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.resolveComponent), [\"toDisplayString\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.toDisplayString), [\"unref\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.unref), [\"vModelRadio\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.vModelRadio), [\"vModelText\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.vModelText), [\"version\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.version), [\"watch\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.watch), [\"withDirectives\"]: () => (__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__.withDirectives) });","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"top-nav card\" };\nimport { useRouter } from 'vue-router';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'TopNavBar',\n    setup(__props) {\n        const router = useRouter();\n        function goStart() {\n            void router.push('/');\n        }\n        function goGame() {\n            void router.push('/game');\n        }\n        function goHistory() {\n            void router.push('/history');\n        }\n        function goSettings() {\n            void router.push('/settings');\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"header\", _hoisted_1, [\n                _createElementVNode(\"button\", {\n                    class: \"btn\",\n                    onClick: goStart\n                }, \"首页\"),\n                _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"spacer\" }, null, -1 /* CACHED */)),\n                _createElementVNode(\"button\", {\n                    class: \"btn\",\n                    onClick: goGame\n                }, \"主界面\"),\n                _createElementVNode(\"button\", {\n                    class: \"btn\",\n                    onClick: goHistory\n                }, \"历史\"),\n                _createElementVNode(\"button\", {\n                    class: \"btn\",\n                    onClick: goSettings\n                }, \"设置\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./TopNavBar.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./TopNavBar.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./TopNavBar.vue?vue&type=style&index=0&id=62b2dca0&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-62b2dca0\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = [\"data-theme\", \"data-font\", \"data-font-size\"];\nconst _hoisted_2 = { class: \"app-main\" };\nimport { useRoute } from 'vue-router';\nimport TopNavBar from './components/TopNavBar.vue';\nimport { useSettingsStore } from './stores/settingsStore';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const route = useRoute();\n        const settingsStore = useSettingsStore();\n        return (_ctx, _cache) => {\n            const _component_router_view = _resolveComponent(\"router-view\");\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"app-shell\",\n                \"data-theme\": _unref(settingsStore).settings.theme,\n                \"data-font\": _unref(settingsStore).settings.fontScheme,\n                \"data-font-size\": _unref(settingsStore).settings.fontSize\n            }, [\n                (_unref(route).name !== 'start')\n                    ? (_openBlock(), _createBlock(TopNavBar, { key: 0 }))\n                    : _createCommentVNode(\"v-if\", true),\n                _createElementVNode(\"main\", _hoisted_2, [\n                    _createVNode(_component_router_view)\n                ])\n            ], 8 /* PROPS */, _hoisted_1));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=dea1f0fc&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.28_typescript@6.0.0-dev.20250807__webpack@5.105.2/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-dea1f0fc\"]])\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport { createApp, version as vueVersion } from 'vue';\nimport { createMemoryHistory, createRouter } from 'vue-router';\nimport App from './App.vue';\nimport './global.scss';\n\ntype JQueryLike = {\n  (handler: () => void): unknown;\n  (target: Window): { on: (event: string, handler: () => void) => void };\n};\n\nconst router = createRouter({\n  history: createMemoryHistory(),\n  routes: [\n    { path: '/', name: 'start', component: () => import('./components/StartScreen.vue') },\n    { path: '/game', name: 'game', component: () => import('./components/GameMain.vue') },\n    { path: '/history', name: 'history', component: () => import('./components/HistoryMessages.vue') },\n    { path: '/settings', name: 'settings', component: () => import('./components/SettingsPage.vue') },\n  ],\n});\n\nconst app = createApp(App);\napp.use(createPinia());\napp.use(router);\n\nfunction getJQuery(): JQueryLike | null {\n  const maybe$ = (globalThis as unknown as { $?: unknown }).$;\n  return typeof maybe$ === 'function' ? (maybe$ as JQueryLike) : null;\n}\n\nfunction onReady(handler: () => void) {\n  const $ = getJQuery();\n  if ($) {\n    $(handler);\n    return;\n  }\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', handler, { once: true });\n  } else {\n    handler();\n  }\n}\n\nfunction onPageHide(handler: () => void) {\n  const $ = getJQuery();\n  if ($) {\n    $(window).on('pagehide', handler);\n    return;\n  }\n  window.addEventListener('pagehide', handler, { once: true });\n}\n\nfunction formatError(error: unknown): string {\n  if (error instanceof Error) return `${error.name}: ${error.message}`;\n  return String(error);\n}\n\nfunction renderFatalError(error: unknown) {\n  const appEl = document.getElementById('app');\n  if (!appEl) return;\n  appEl.innerHTML = `\n    <div style=\"padding:12px;border:1px solid #f0d4d4;border-radius:8px;background:#fff7f7;color:#7a3030;line-height:1.6;\">\n      <div style=\"font-weight:700;margin-bottom:6px;\">同层前端启动失败</div>\n      <div style=\"white-space:pre-wrap;word-break:break-word;\">${formatError(error)}</div>\n    </div>\n  `;\n}\n\nasync function bootstrap() {\n  const appEl = document.getElementById('app');\n  const globalVueVersion = (globalThis as unknown as { Vue?: { version?: string } }).Vue?.version;\n  console.info('[同层前端_v3][probe] vueVersion(import):', vueVersion);\n  console.info('[同层前端_v3][probe] vueVersion(globalThis.Vue):', globalVueVersion ?? 'undefined');\n  console.info('[同层前端_v3][probe] #app exists/isConnected:', !!appEl, appEl?.isConnected ?? false);\n\n  await router.replace('/');\n  await router.isReady();\n  app.mount('#app');\n}\n\napp.config.errorHandler = error => {\n  console.error('[同层前端_v3] Vue 运行时错误:', error);\n};\n\nrouter.onError(error => {\n  console.error('[同层前端_v3] 路由错误:', error);\n});\n\nonReady(() => {\n  bootstrap().catch(error => {\n    console.error('[同层前端_v3] 启动失败:', error);\n    renderFatalError(error);\n  });\n});\n\nonPageHide(() => {\n  try {\n    app.unmount();\n  } catch (error) {\n    console.warn('[同层前端_v3] 卸载异常:', error);\n  }\n});\n"],"names":["resolveMessageId","input","Number","isFinite","latest","getLastMessageId","useCharacterStore","defineStore","isReady","ref","mvuData","async","refresh","messageId","value","waitGlobalInitialized","data","Mvu","getMvuData","type","message_id","stat_data","error","console","warn","initialize","getCurrentSceneCharacters","names","Array","isArray","POV_STORAGE_KEY","POV_OPENING_MAP","DEFAULT_POV","useGameStore","currentMessage","currentMessageId","options","isGenerating","isLoading","selectedPov","localStorage","getItem","length","loadPov","setMessage","message","setOptions","next","setGenerating","setLoading","setPov","pov","setItem","getOpeningLine","listAvailablePov","Object","keys","STORAGE_KEY","defaultSettings","theme","fontScheme","fontSize","useSettingsStore","settings","raw","parsed","JSON","parse","parseSettings","watch","stringify","deep","updateSettings","resetSettings","_hoisted_1","class","_hoisted_2","_hoisted_3","__name","props","setup","__props","computed","_ctx","_cache","key","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","disabled","Boolean","emits","emit","__emit","customText","submitCustom","text","id","Date","now","title","content","isCustom","item","onClick","$event","placeholder","trim","gameStore","characterStore","sceneCharactersText","list","join","isAssistantMessageLike","loadLatestAssistantMessage","latestId","current","candidate","getChatMessages","role","hide_state","block","match","lines","split","map","line","filter","i","matched","push","replace","parseOptionsFromMessage","refreshAll","handleSelect","option","createChatMessages","triggerSlash","stopRendered","onMounted","eventOn","tavern_events","CHARACTER_MESSAGE_RENDERED","onUnmounted","stop","MessageDisplay","OptionsPanel","onSelect","router","useRouter","rows","keyword","filtered","toLowerCase","includes","reload","found","settingsStore","onThemeChange","event","target","onFontChange","onSizeChange","onChange","args","isFirstRun","povOptions","pendingPov","handleStart","name","exports","sfc","__vccOpts","val","module","y","x","__webpack_require__","d","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_pinia_esm_b723a504__","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_router_esm_7a560a22__","__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_vue_esm_81736d96__","__webpack_module_cache__","moduleId","cachedModule","undefined","__webpack_modules__","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","goStart","goGame","goHistory","goSettings","route","useRoute","_component_router_view","TopNavBar","createRouter","history","createMemoryHistory","routes","path","component","app","createApp","App","getJQuery","maybe$","globalThis","$","renderFatalError","appEl","document","getElementById","innerHTML","Error","String","formatError","use","createPinia","config","errorHandler","onError","handler","readyState","addEventListener","once","onReady","globalVueVersion","Vue","version","info","isConnected","mount","bootstrap","catch","window","on","onPageHide","unmount"],"sourceRoot":""}