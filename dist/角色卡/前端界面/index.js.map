{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/src/角色卡/前端界面/config/opening_by_perspective.yaml?f5d1","src://tavern_helper_template/src/角色卡/前端界面/App.vue","webpack://tavern_helper_template/src/角色卡/前端界面/App.vue?1808","src://tavern_helper_template/src/角色卡/前端界面/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","export default {perspectives:{'心爱':{description:'以保登心爱的情绪与语气观察事件发展，优先关注热情、主动与当下氛围。',opening:'你在清晨推开 Rabbit House 的门，熟悉的甜香与轻快脚步声同时向你迎来。'},'智乃':{description:'以香风智乃的克制与细腻感知推进剧情，优先关注细节与隐含情绪变化。',opening:'你端正地整理围裙与托盘，抬眼时，门铃正好响起，今天的第一位客人到了。'},'理世':{description:'以天天座理世的执行力推进剧情，优先处理秩序、任务与突发状况。',opening:'你快速扫视店内座位与动线，确认一切就绪后，今天的营业正式开始。'},'千夜':{description:'以宇治松千夜的温婉风格观察互动，优先关注礼节、安抚与氛围调和。',opening:'你轻轻摆好茶点，窗外风铃声细微晃动，一段柔和却重要的对话即将开始。'},'纱路':{description:'以桐间纱路的谨慎与责任感参与剧情，优先关注风险与规则边界。',opening:'你深呼吸后推门而入，尽量让自己的步伐显得从容，不让紧张暴露在表情里。'},'无':{description:'使用中立视角，不绑定具体角色语气，更适合观察多角色并行叙事。',opening:'午后钟声落下，你推门进入熟悉的咖啡馆，空气里有甜点与咖啡的暖香。'}}};","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, vModelText as _vModelText, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, normalizeClass as _normalizeClass, vModelSelect as _vModelSelect, vModelRadio as _vModelRadio, createTextVNode as _createTextVNode, vModelCheckbox as _vModelCheckbox, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = [\"data-theme\", \"data-reduced-motion\"];\nconst _hoisted_2 = {\n    key: 0,\n    class: \"splash-screen\"\n};\nconst _hoisted_3 = {\n    id: \"region-top-nav\",\n    role: \"banner\",\n    \"aria-label\": \"顶部导航\"\n};\nconst _hoisted_4 = {\n    id: \"nav-feature-entry\",\n    \"aria-label\": \"功能入口\"\n};\nconst _hoisted_5 = {\n    id: \"region-main-content\",\n    role: \"main\"\n};\nconst _hoisted_6 = {\n    id: \"panel-story-feed\",\n    \"aria-labelledby\": \"heading-story-feed\",\n    class: \"card panel-story\"\n};\nconst _hoisted_7 = [\"aria-busy\"];\nconst _hoisted_8 = {\n    id: \"panel-option-actions\",\n    \"aria-labelledby\": \"heading-option-actions\",\n    class: \"card panel-options\"\n};\nconst _hoisted_9 = { class: \"panel-head-row\" };\nconst _hoisted_10 = {\n    key: 0,\n    id: \"status-generating\",\n    class: \"status-chip\",\n    \"aria-live\": \"assertive\"\n};\nconst _hoisted_11 = {\n    id: \"list-option-cards\",\n    class: \"option-list\"\n};\nconst _hoisted_12 = [\"id\", \"disabled\", \"onClick\"];\nconst _hoisted_13 = { class: \"custom-option-row\" };\nconst _hoisted_14 = [\"disabled\"];\nconst _hoisted_15 = [\"disabled\"];\nconst _hoisted_16 = {\n    id: \"panel-character-status\",\n    \"aria-labelledby\": \"heading-character-status\",\n    class: \"card panel-characters\"\n};\nconst _hoisted_17 = {\n    id: \"list-character-avatars\",\n    class: \"avatar-list\"\n};\nconst _hoisted_18 = [\"id\", \"onClick\"];\nconst _hoisted_19 = {\n    class: \"avatar-thumb-wrap\",\n    \"aria-hidden\": \"true\"\n};\nconst _hoisted_20 = [\"id\", \"src\", \"alt\", \"onError\"];\nconst _hoisted_21 = { class: \"avatar-name\" };\nconst _hoisted_22 = {\n    id: \"region-quick-actions\",\n    \"aria-label\": \"快捷操作\",\n    class: \"quick-actions\"\n};\nconst _hoisted_23 = [\"title\"];\nconst _hoisted_24 = {\n    class: \"modal-shell\",\n    tabindex: \"-1\"\n};\nconst _hoisted_25 = {\n    class: \"tab-nav\",\n    \"aria-label\": \"功能标签页\"\n};\nconst _hoisted_26 = {\n    key: 0,\n    id: \"panel-tab-history\",\n    class: \"tab-panel\",\n    \"aria-live\": \"polite\"\n};\nconst _hoisted_27 = { class: \"panel-tools\" };\nconst _hoisted_28 = {\n    id: \"list-history-messages\",\n    class: \"history-list\"\n};\nconst _hoisted_29 = [\"id\"];\nconst _hoisted_30 = { class: \"badge\" };\nconst _hoisted_31 = { class: \"badge muted\" };\nconst _hoisted_32 = { class: \"badge muted\" };\nconst _hoisted_33 = [\"id\", \"onClick\"];\nconst _hoisted_34 = { class: \"panel-actions-row\" };\nconst _hoisted_35 = [\"disabled\"];\nconst _hoisted_36 = {\n    key: 1,\n    id: \"panel-tab-worldbook\",\n    class: \"tab-panel\",\n    \"aria-live\": \"polite\"\n};\nconst _hoisted_37 = { class: \"panel-tools\" };\nconst _hoisted_38 = [\"value\"];\nconst _hoisted_39 = {\n    key: 0,\n    class: \"inline-error\"\n};\nconst _hoisted_40 = {\n    key: 1,\n    class: \"inline-tip\"\n};\nconst _hoisted_41 = {\n    id: \"list-worldbook-entries\",\n    class: \"worldbook-list\"\n};\nconst _hoisted_42 = [\"id\"];\nconst _hoisted_43 = [\"id\", \"onClick\"];\nconst _hoisted_44 = { class: \"entry-meta\" };\nconst _hoisted_45 = {\n    key: 2,\n    id: \"panel-tab-settings\",\n    class: \"tab-panel\",\n    \"aria-live\": \"polite\"\n};\nconst _hoisted_46 = { class: \"setting-group\" };\nconst _hoisted_47 = { class: \"setting-group\" };\nconst _hoisted_48 = { class: \"setting-group\" };\nconst _hoisted_49 = { class: \"setting-group\" };\nconst _hoisted_50 = {\n    key: 3,\n    id: \"panel-tab-character\",\n    class: \"tab-panel\",\n    \"aria-live\": \"polite\"\n};\nconst _hoisted_51 = { class: \"character-panel\" };\nconst _hoisted_52 = { class: \"character-selector\" };\nconst _hoisted_53 = [\"id\", \"onClick\"];\nconst _hoisted_54 = {\n    id: \"panel-character-detail-card\",\n    class: \"character-detail-card\"\n};\nconst _hoisted_55 = {\n    class: \"character-hero\",\n    \"aria-hidden\": \"true\"\n};\nconst _hoisted_56 = [\"src\", \"alt\"];\nconst _hoisted_57 = {\n    class: \"modal-shell perspective-shell\",\n    tabindex: \"-1\"\n};\nconst _hoisted_58 = { class: \"perspective-list\" };\nconst _hoisted_59 = [\"id\", \"onClick\"];\nconst _hoisted_60 = {\n    class: \"opening-preview-wrap\",\n    \"aria-live\": \"polite\"\n};\nconst _hoisted_61 = { id: \"text-opening-preview\" };\nconst _hoisted_62 = [\"disabled\"];\nimport { computed, nextTick, onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport openingConfigRaw from './config/opening_by_perspective.yaml';\nconst SETTINGS_STORAGE_KEY = 'gochiusa.frontend.settings.v2';\nconst PERSPECTIVE_VAR_PATH = '前端界面.主视角';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const perspectiveKeys = ['心爱', '智乃', '理世', '千夜', '纱路', '无'];\n        const fallbackOpeningConfig = {\n            perspectives: {\n                心爱: {\n                    description: '以保登心爱的情绪与语气观察事件发展，优先关注热情、主动与当下氛围。',\n                    opening: '你在清晨推开兔屋咖啡馆的大门，熟悉的甜香与轻快脚步声同时向你迎来。',\n                },\n                智乃: {\n                    description: '以香风智乃的克制与细腻感知推进剧情，优先关注细节与隐含情绪变化。',\n                    opening: '你端正地整理围裙与托盘，抬眼时，门铃正好响起，今天的第一位客人到了。',\n                },\n                理世: {\n                    description: '以天天座理世的执行力推进剧情，优先处理秩序、任务与突发状况。',\n                    opening: '你快速扫视店内座位与动线，确认一切就绪后，今天的营业正式开始。',\n                },\n                千夜: {\n                    description: '以宇治松千夜的温婉风格观察互动，优先关注礼节、安抚与氛围调和。',\n                    opening: '你轻轻摆好茶点，窗外风铃声细微晃动，一段柔和却重要的对话即将开始。',\n                },\n                纱路: {\n                    description: '以桐间纱路的谨慎与责任感参与剧情，优先关注风险与规则边界。',\n                    opening: '你深呼吸后推门而入，尽量让自己的步伐显得从容，不让紧张暴露在表情里。',\n                },\n                无: {\n                    description: '使用中立视角，不绑定具体角色语气，更适合观察多角色并行叙事。',\n                    opening: '午后钟声落下，你推门进入熟悉的咖啡馆，空气里有甜点与咖啡的暖香。',\n                },\n            },\n        };\n        const defaultSettings = {\n            theme: 'theme-latte-noir',\n            displayMode: 'instant',\n            fontScale: 'medium',\n            autoScroll: true,\n            reduceMotion: false,\n        };\n        function catboxImage(code) {\n            return `https://files.catbox.moe/${code}.png`;\n        }\n        const characterProfiles = [\n            {\n                key: 'cocoa',\n                name: '保登心爱',\n                color: 'var(--clr-cocoa)',\n                avatarUrl: catboxImage('qjltca'),\n                summary: '活力型引导角色，擅长快速拉近关系并推动场景气氛。',\n                mood: '开朗',\n                location: '兔屋咖啡馆前厅',\n                outfit: '咖啡厅制服',\n                relation: '友好',\n            },\n            {\n                key: 'chino',\n                name: '香风智乃',\n                color: 'var(--clr-chino)',\n                avatarUrl: catboxImage('6t09pw'),\n                summary: '观察型角色，擅长在安静场景中提供高价值细节。',\n                mood: '冷静',\n                location: '吧台内侧',\n                outfit: '咖啡厅制服',\n                relation: '信任建立中',\n            },\n            {\n                key: 'rize',\n                name: '天天座理世',\n                color: 'var(--clr-rize)',\n                avatarUrl: catboxImage('n9szhx'),\n                summary: '执行型角色，擅长处理节奏与秩序相关场景。',\n                mood: '专注',\n                location: '点单与出餐动线',\n                outfit: '咖啡厅制服',\n                relation: '可靠同伴',\n            },\n            {\n                key: 'chiya',\n                name: '宇治松千夜',\n                color: 'var(--clr-chiya)',\n                avatarUrl: catboxImage('v4spnt'),\n                summary: '情绪调和型角色，擅长缓冲冲突与提升舒适感。',\n                mood: '温和',\n                location: '甜点展示区',\n                outfit: '和风改良制服',\n                relation: '亲近',\n            },\n            {\n                key: 'syaro',\n                name: '桐间纱路',\n                color: 'var(--clr-syaro)',\n                avatarUrl: catboxImage('b982xz'),\n                summary: '谨慎型角色，适合调查、推理与高压交互场景。',\n                mood: '紧张但坚定',\n                location: '门厅与过道',\n                outfit: '学院日常装',\n                relation: '逐步加深',\n            },\n        ];\n        const perspectiveToCharacter = {\n            心爱: 'cocoa',\n            智乃: 'chino',\n            理世: 'rize',\n            千夜: 'chiya',\n            纱路: 'syaro',\n            无: 'cocoa',\n        };\n        function isPerspectiveKey(value) {\n            return perspectiveKeys.includes(value);\n        }\n        function normalizeOpeningConfig(input) {\n            const base = _.cloneDeep(fallbackOpeningConfig);\n            if (!input || typeof input !== 'object')\n                return base;\n            const raw = input.perspectives;\n            if (!raw || typeof raw !== 'object')\n                return base;\n            perspectiveKeys.forEach(key => {\n                const candidate = raw[key];\n                if (candidate &&\n                    typeof candidate.description === 'string' &&\n                    candidate.description.trim().length > 0 &&\n                    typeof candidate.opening === 'string' &&\n                    candidate.opening.trim().length > 0) {\n                    base.perspectives[key] = { description: candidate.description, opening: candidate.opening };\n                }\n            });\n            return base;\n        }\n        function loadSettings() {\n            try {\n                const raw = localStorage.getItem(SETTINGS_STORAGE_KEY);\n                if (!raw)\n                    return defaultSettings;\n                const parsed = JSON.parse(raw);\n                return {\n                    theme: parsed.theme === 'theme-midnight-salon' ? 'theme-midnight-salon' : 'theme-latte-noir',\n                    displayMode: parsed.displayMode === 'typewriter' || parsed.displayMode === 'segment' ? parsed.displayMode : 'instant',\n                    fontScale: parsed.fontScale === 'small' || parsed.fontScale === 'large' ? parsed.fontScale : 'medium',\n                    autoScroll: parsed.autoScroll !== false,\n                    reduceMotion: parsed.reduceMotion === true,\n                };\n            }\n            catch {\n                return defaultSettings;\n            }\n        }\n        function upsertMetaDescription(content) {\n            const selector = 'meta[name=\"description\"]';\n            let meta = document.head.querySelector(selector);\n            if (!meta) {\n                meta = document.createElement('meta');\n                meta.name = 'description';\n                document.head.appendChild(meta);\n            }\n            meta.content = content;\n        }\n        function segmentText(input) {\n            return input\n                .replace(/([。！？!?])(?=[^\\n])/g, '$1\\n')\n                .replace(/\\n{3,}/g, '\\n\\n')\n                .trim();\n        }\n        function roleLabel(role) {\n            if (role === 'assistant')\n                return '助手';\n            if (role === 'user')\n                return '玩家';\n            return '系统';\n        }\n        function truncateText(text, max = 120) {\n            if (text.length <= max)\n                return text;\n            return `${text.slice(0, max)}...`;\n        }\n        function onAvatarImageError(event, characterName) {\n            const target = event.target;\n            if (!target)\n                return;\n            target.onerror = null;\n            target.src = `https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(characterName)}`;\n        }\n        function extractRoleplayOptions(message) {\n            const block = message.match(/<roleplay_options>([\\s\\S]*?)<\\/roleplay_options>/i)?.[1] ?? '';\n            if (!block.trim())\n                return [];\n            return [...block.matchAll(/(.+?)[:：]\\s*(.+)/g)].map((match, index) => ({\n                id: `opt-dynamic-${index + 1}`,\n                title: match[1].trim(),\n                content: match[2].trim(),\n            }));\n        }\n        const openingConfig = normalizeOpeningConfig(openingConfigRaw);\n        const settings = ref(loadSettings());\n        const isCharacterDockCollapsed = ref(false);\n        const isFeatureModalVisible = ref(false);\n        const activeTab = ref('history');\n        const showPerspectiveSelector = ref(false);\n        const isSplashScreenVisible = ref(true);\n        const selectedPerspective = ref(null);\n        const perspectiveConfirmed = ref(false);\n        const customOption = ref('');\n        const isFullscreen = ref(false);\n        const isBusyGenerating = ref(false);\n        const rawCurrentMessage = ref('正在等待剧情推进，请选择下一步行动。');\n        const displayedMessage = ref('正在等待剧情推进，请选择下一步行动。');\n        const activeCharacterKey = ref('cocoa');\n        const chatVariablesSnapshot = ref({});\n        const historyMessages = ref([]);\n        const historyDepth = ref(40);\n        const historyQuery = ref('');\n        const worldbookNames = ref([]);\n        const selectedWorldbookName = ref('');\n        const worldbookEntries = ref([]);\n        const worldbookQuery = ref('');\n        const worldbookError = ref('');\n        const isWorldbookLoading = ref(false);\n        const lastMessageId = ref(0);\n        const options = ref([\n            { id: 'opt-001', title: '向柜台点单', content: '你走向柜台，礼貌地询问今日推荐饮品。' },\n            { id: 'opt-002', title: '观察店内', content: '你放慢脚步，观察店内客人与角色之间的互动细节。' },\n            { id: 'opt-003', title: '主动搭话', content: '你选择与当前出场角色展开一段自然交流。' },\n        ]);\n        const fontScaleMap = {\n            small: '0.92',\n            medium: '1',\n            large: '1.08',\n        };\n        const pageRootStyle = computed(() => ({\n            '--font-scale': fontScaleMap[settings.value.fontScale],\n        }));\n        const perspectiveEntries = computed(() => {\n            return perspectiveKeys.map(key => ({\n                key,\n                ...openingConfig.perspectives[key],\n            }));\n        });\n        const selectedOpeningPreview = computed(() => {\n            const key = selectedPerspective.value;\n            if (!key)\n                return '请选择一个主视角后查看对应开场白。';\n            return openingConfig.perspectives[key].opening;\n        });\n        const displayModeLabel = computed(() => {\n            if (settings.value.displayMode === 'typewriter')\n                return '显示模式：打字机';\n            if (settings.value.displayMode === 'segment')\n                return '显示模式：分段';\n            return '显示模式：即时';\n        });\n        const historyFilteredMessages = computed(() => {\n            const keyword = historyQuery.value.trim().toLowerCase();\n            const sorted = [...historyMessages.value].sort((lhs, rhs) => rhs.message_id - lhs.message_id);\n            if (!keyword)\n                return sorted;\n            return sorted.filter(msg => {\n                const text = `${msg.name} ${msg.message}`.toLowerCase();\n                return text.includes(keyword);\n            });\n        });\n        const historyHasMore = computed(() => {\n            return historyDepth.value < lastMessageId.value + 1;\n        });\n        const filteredWorldbookEntries = computed(() => {\n            const keyword = worldbookQuery.value.trim().toLowerCase();\n            if (!keyword)\n                return worldbookEntries.value;\n            return worldbookEntries.value.filter(entry => {\n                const text = `${entry.name} ${entry.content}`.toLowerCase();\n                return text.includes(keyword);\n            });\n        });\n        const activeCharacter = computed(() => {\n            const match = characterProfiles.find(item => item.key === activeCharacterKey.value);\n            return match ?? characterProfiles[0];\n        });\n        const activeCharacterState = computed(() => {\n            const profile = activeCharacter.value;\n            const vars = chatVariablesSnapshot.value;\n            const mood = _.get(vars, `${profile.name}.心情`) ??\n                _.get(vars, `角色状态.${profile.name}.心情`) ??\n                _.get(vars, `角色.${profile.name}.心情`) ??\n                profile.mood;\n            const location = _.get(vars, `${profile.name}.位置`) ??\n                _.get(vars, `角色状态.${profile.name}.位置`) ??\n                _.get(vars, `角色.${profile.name}.位置`) ??\n                profile.location;\n            const outfit = _.get(vars, `${profile.name}.着装`) ??\n                _.get(vars, `角色状态.${profile.name}.着装`) ??\n                _.get(vars, `角色.${profile.name}.着装`) ??\n                profile.outfit;\n            const relation = _.get(vars, `${profile.name}.关系`) ??\n                _.get(vars, `角色状态.${profile.name}.关系`) ??\n                _.get(vars, `角色.${profile.name}.关系`) ??\n                profile.relation;\n            return {\n                mood: String(mood),\n                location: String(location),\n                outfit: String(outfit),\n                relation: String(relation),\n            };\n        });\n        const eventStops = [];\n        let typewriterTimer = null;\n        let lastFocusedElement = null;\n        function clearTypewriterTimer() {\n            if (typewriterTimer === null)\n                return;\n            window.clearInterval(typewriterTimer);\n            typewriterTimer = null;\n        }\n        function applyDisplayMessage(text) {\n            clearTypewriterTimer();\n            if (settings.value.displayMode === 'instant') {\n                displayedMessage.value = text;\n                return;\n            }\n            if (settings.value.displayMode === 'segment') {\n                displayedMessage.value = segmentText(text);\n                return;\n            }\n            const chars = Array.from(text);\n            displayedMessage.value = '';\n            let index = 0;\n            typewriterTimer = window.setInterval(() => {\n                index += 1;\n                displayedMessage.value = chars.slice(0, index).join('');\n                if (index >= chars.length) {\n                    clearTypewriterTimer();\n                }\n            }, settings.value.reduceMotion ? 8 : 20);\n        }\n        function saveSettings() {\n            localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(settings.value));\n        }\n        function resetSettings() {\n            settings.value = _.cloneDeep(defaultSettings);\n            saveSettings();\n            toastr.success('设置已恢复默认值。');\n        }\n        function toggleDisplayMode() {\n            const chain = ['instant', 'typewriter', 'segment'];\n            const index = chain.indexOf(settings.value.displayMode);\n            settings.value.displayMode = chain[(index + 1) % chain.length];\n        }\n        function readPerspectiveFromChatVariables() {\n            try {\n                const vars = getVariables({ type: 'chat' });\n                const value = _.get(vars, PERSPECTIVE_VAR_PATH);\n                return isPerspectiveKey(value) ? value : null;\n            }\n            catch {\n                return null;\n            }\n        }\n        function syncLastMessageId() {\n            const value = getLastMessageId();\n            lastMessageId.value = value;\n            return value;\n        }\n        function persistPerspectiveToChatVariables(value) {\n            try {\n                updateVariablesWith(vars => {\n                    _.set(vars, PERSPECTIVE_VAR_PATH, value);\n                    return vars;\n                }, { type: 'chat' });\n            }\n            catch (error) {\n                console.warn('保存主视角到聊天变量失败:', error);\n            }\n        }\n        function shouldShowPerspectiveModal() {\n            return syncLastMessageId() === 0;\n        }\n        function getPerspectiveOpening() {\n            const key = selectedPerspective.value ?? '无';\n            return openingConfig.perspectives[key].opening;\n        }\n        function confirmPerspective() {\n            if (!selectedPerspective.value)\n                return;\n            perspectiveConfirmed.value = true;\n            showPerspectiveSelector.value = false;\n            persistPerspectiveToChatVariables(selectedPerspective.value);\n            const mapped = perspectiveToCharacter[selectedPerspective.value];\n            if (mapped)\n                activeCharacterKey.value = mapped;\n            if (syncLastMessageId() === 0) {\n                rawCurrentMessage.value = getPerspectiveOpening();\n                updateOptionsFromMessage(rawCurrentMessage.value);\n            }\n            toastr.success(`主视角已确定：${selectedPerspective.value}`);\n        }\n        function loadHistory(reset = false) {\n            if (reset) {\n                historyDepth.value = 40;\n            }\n            const lastId = syncLastMessageId();\n            const start = Math.max(0, lastId - historyDepth.value + 1);\n            const range = `${start}-${lastId}`;\n            historyMessages.value = getChatMessages(range, { hide_state: 'unhidden' });\n        }\n        function loadMoreHistory() {\n            historyDepth.value += 40;\n            loadHistory(false);\n        }\n        function useHistoryAsCustom(message) {\n            customOption.value = message;\n            closeFeatureModal();\n            toastr.info('已将历史消息填入自定义选项输入框。');\n        }\n        async function loadWorldbookNames() {\n            const names = [];\n            try {\n                const bind = getCharWorldbookNames('current');\n                names.push(...[bind.primary, ...bind.additional].filter((item) => Boolean(item)));\n            }\n            catch {\n                // 当前没有可用角色卡时会走到这里，使用全量世界书兜底\n            }\n            if (!names.length) {\n                names.push(...getWorldbookNames());\n            }\n            worldbookNames.value = Array.from(new Set(names));\n            if (!worldbookNames.value.length) {\n                selectedWorldbookName.value = '';\n                worldbookEntries.value = [];\n                return;\n            }\n            if (!worldbookNames.value.includes(selectedWorldbookName.value)) {\n                selectedWorldbookName.value = worldbookNames.value[0];\n            }\n        }\n        async function loadWorldbookEntries() {\n            if (!selectedWorldbookName.value) {\n                worldbookEntries.value = [];\n                return;\n            }\n            isWorldbookLoading.value = true;\n            worldbookError.value = '';\n            try {\n                worldbookEntries.value = await getWorldbook(selectedWorldbookName.value);\n            }\n            catch (error) {\n                worldbookError.value = '读取世界书失败，请检查绑定状态。';\n                console.error(error);\n            }\n            finally {\n                isWorldbookLoading.value = false;\n            }\n        }\n        async function reloadWorldbook() {\n            await loadWorldbookNames();\n            await loadWorldbookEntries();\n        }\n        async function toggleWorldbookEntryState(uid, enabled) {\n            if (!selectedWorldbookName.value)\n                return;\n            try {\n                worldbookEntries.value = await updateWorldbookWith(selectedWorldbookName.value, entries => {\n                    return entries.map(entry => {\n                        if (entry.uid !== uid)\n                            return entry;\n                        return { ...entry, enabled };\n                    });\n                });\n            }\n            catch (error) {\n                toastr.error('世界书条目状态更新失败。');\n                console.error(error);\n            }\n        }\n        function refreshChatVariablesSnapshot() {\n            try {\n                chatVariablesSnapshot.value = getVariables({ type: 'chat' });\n            }\n            catch {\n                chatVariablesSnapshot.value = {};\n            }\n        }\n        function updateOptionsFromMessage(message) {\n            const dynamic = extractRoleplayOptions(message);\n            if (dynamic.length > 0) {\n                options.value = dynamic;\n            }\n        }\n        function refreshLatestAssistantMessage() {\n            const lastId = syncLastMessageId();\n            const start = Math.max(0, lastId - 80);\n            const range = `${start}-${lastId}`;\n            const list = getChatMessages(range, { role: 'assistant', hide_state: 'unhidden' });\n            const latest = list.at(-1);\n            if (!latest || typeof latest.message !== 'string')\n                return;\n            rawCurrentMessage.value = latest.message;\n            updateOptionsFromMessage(latest.message);\n        }\n        function scrollStoryIfNeeded() {\n            if (!settings.value.autoScroll)\n                return;\n            const target = document.getElementById('story-current-message');\n            target?.scrollIntoView({ behavior: settings.value.reduceMotion ? 'auto' : 'smooth', block: 'nearest' });\n        }\n        async function handleOption(content) {\n            const clean = content.trim();\n            if (!clean) {\n                toastr.info('选项内容为空，无法发送。');\n                return;\n            }\n            if (showPerspectiveSelector.value || !perspectiveConfirmed.value) {\n                toastr.warning('请先完成主视角选择。');\n                return;\n            }\n            if (isBusyGenerating.value)\n                return;\n            isBusyGenerating.value = true;\n            try {\n                const isFirstTurn = syncLastMessageId() === 0;\n                await createChatMessages([{ role: 'user', message: clean }]);\n                const result = await generate({\n                    user_input: clean,\n                    should_stream: false,\n                    overrides: isFirstTurn\n                        ? {\n                            chat_history: {\n                                prompts: [{ role: 'assistant', content: getPerspectiveOpening() }],\n                            },\n                        }\n                        : undefined,\n                });\n                const latest = getChatMessages(-1)[0];\n                if (!latest || latest.role !== 'assistant') {\n                    await createChatMessages([{ role: 'assistant', message: result }]);\n                }\n                rawCurrentMessage.value = result;\n                refreshLatestAssistantMessage();\n                updateOptionsFromMessage(result);\n                syncLastMessageId();\n                loadHistory(false);\n                refreshChatVariablesSnapshot();\n                scrollStoryIfNeeded();\n            }\n            catch (error) {\n                toastr.error('发送选项或生成回复失败。');\n                console.error(error);\n            }\n            finally {\n                isBusyGenerating.value = false;\n            }\n        }\n        async function submitCustomOption() {\n            const value = customOption.value.trim();\n            if (!value) {\n                toastr.info('请先填写自定义选项内容。');\n                return;\n            }\n            options.value.unshift({\n                id: `opt-custom-${Date.now()}`,\n                title: '自定义行动',\n                content: value,\n            });\n            customOption.value = '';\n            await handleOption(value);\n        }\n        async function toggleFullscreen() {\n            try {\n                if (!document.fullscreenElement) {\n                    await document.documentElement.requestFullscreen();\n                    isFullscreen.value = true;\n                    return;\n                }\n                await document.exitFullscreen();\n                isFullscreen.value = false;\n            }\n            catch (error) {\n                toastr.warning('当前环境不支持全屏切换。');\n                console.warn(error);\n            }\n        }\n        function handleStart() {\n            isSplashScreenVisible.value = false;\n        }\n        function focusCurrentModalFirstItem() {\n            nextTick(() => {\n                if (showPerspectiveSelector.value) {\n                    const selector = document.getElementById('btn-select-perspective-心爱') ?? document.getElementById('btn-confirm-perspective');\n                    selector?.focus();\n                    return;\n                }\n                if (isFeatureModalVisible.value) {\n                    const target = document.getElementById(`modal-tab-${activeTab.value}`) ?? document.getElementById('btn-close-feature-modal');\n                    target?.focus();\n                }\n            });\n        }\n        function openFeatureModal(tab) {\n            lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n            activeTab.value = tab;\n            isFeatureModalVisible.value = true;\n            focusCurrentModalFirstItem();\n        }\n        function closeFeatureModal() {\n            isFeatureModalVisible.value = false;\n            nextTick(() => {\n                lastFocusedElement?.focus();\n            });\n        }\n        function openCharacterDetail(characterKey) {\n            activeCharacterKey.value = characterKey;\n            openFeatureModal('character');\n        }\n        function trapFocusInModal(event, modalId) {\n            if (event.key !== 'Tab')\n                return;\n            const modal = document.getElementById(modalId);\n            if (!modal)\n                return;\n            const selectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])';\n            const focusable = [...modal.querySelectorAll(selectors)].filter(item => !item.hasAttribute('disabled'));\n            if (!focusable.length)\n                return;\n            const first = focusable[0];\n            const last = focusable[focusable.length - 1];\n            if (event.shiftKey && document.activeElement === first) {\n                event.preventDefault();\n                last.focus();\n            }\n            else if (!event.shiftKey && document.activeElement === last) {\n                event.preventDefault();\n                first.focus();\n            }\n        }\n        function onGlobalKeydown(event) {\n            if (event.key !== 'Escape')\n                return;\n            if (showPerspectiveSelector.value)\n                return;\n            if (isFeatureModalVisible.value) {\n                closeFeatureModal();\n            }\n        }\n        async function initializeForCurrentChat() {\n            syncLastMessageId();\n            const cachedPerspective = readPerspectiveFromChatVariables();\n            showPerspectiveSelector.value = shouldShowPerspectiveModal() && !cachedPerspective;\n            selectedPerspective.value = showPerspectiveSelector.value ? cachedPerspective : (cachedPerspective ?? '无');\n            perspectiveConfirmed.value = !showPerspectiveSelector.value;\n            if (!showPerspectiveSelector.value && selectedPerspective.value) {\n                activeCharacterKey.value = perspectiveToCharacter[selectedPerspective.value];\n            }\n            refreshLatestAssistantMessage();\n            loadHistory(true);\n            refreshChatVariablesSnapshot();\n            await reloadWorldbook();\n            if (showPerspectiveSelector.value) {\n                focusCurrentModalFirstItem();\n            }\n        }\n        watch(() => settings.value, () => {\n            saveSettings();\n        }, { deep: true });\n        watch(() => [rawCurrentMessage.value, settings.value.displayMode, settings.value.reduceMotion], () => {\n            applyDisplayMessage(rawCurrentMessage.value);\n        }, { immediate: true });\n        watch(activeTab, tab => {\n            if (tab === 'history') {\n                loadHistory(false);\n                return;\n            }\n            if (tab === 'worldbook') {\n                void reloadWorldbook();\n                return;\n            }\n            if (tab === 'character') {\n                refreshChatVariablesSnapshot();\n            }\n        });\n        watch(selectedWorldbookName, () => {\n            void loadWorldbookEntries();\n        });\n        onMounted(() => {\n            document.title = '点兔文字交互界面';\n            upsertMetaDescription('高沉浸文字互动体验，支持选项驱动叙事、世界书联动与主视角开场注入。');\n            document.addEventListener('keydown', onGlobalKeydown);\n            void initializeForCurrentChat();\n            eventStops.push(eventOn(tavern_events.MESSAGE_RECEIVED, () => {\n                syncLastMessageId();\n                refreshLatestAssistantMessage();\n                loadHistory(false);\n                refreshChatVariablesSnapshot();\n            }).stop);\n            eventStops.push(eventOn(tavern_events.MESSAGE_EDITED, () => {\n                syncLastMessageId();\n                refreshLatestAssistantMessage();\n                loadHistory(false);\n            }).stop);\n            eventStops.push(eventOn(tavern_events.MESSAGE_SWIPED, () => {\n                syncLastMessageId();\n                refreshLatestAssistantMessage();\n            }).stop);\n            eventStops.push(eventOn(tavern_events.CHAT_CHANGED, () => {\n                void initializeForCurrentChat();\n                toastr.info('检测到聊天切换，界面数据已自动同步。');\n            }).stop);\n            eventStops.push(eventOn(tavern_events.WORLDINFO_UPDATED, () => {\n                void reloadWorldbook();\n            }).stop);\n        });\n        onBeforeUnmount(() => {\n            clearTypewriterTimer();\n            document.removeEventListener('keydown', onGlobalKeydown);\n            eventStops.forEach(stop => stop());\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                id: \"page-game-root\",\n                \"data-theme\": settings.value.theme,\n                \"data-font\": \"font-ui-default\",\n                \"data-reduced-motion\": settings.value.reduceMotion ? 'true' : 'false',\n                style: _normalizeStyle(pageRootStyle.value)\n            }, [\n                _cache[67] || (_cache[67] = _createElementVNode(\"div\", { class: \"background-layer\" }, [\n                    _createElementVNode(\"div\", { class: \"bg-gradient\" })\n                ], -1 /* CACHED */)),\n                _createVNode(_Transition, { name: \"fade\" }, {\n                    default: _withCtx(() => [\n                        (isSplashScreenVisible.value)\n                            ? (_openBlock(), _createElementBlock(\"section\", _hoisted_2, [\n                                _cache[29] || (_cache[29] = _createElementVNode(\"div\", { class: \"splash-logo animate-fadeInDown\" }, [\n                                    _createElementVNode(\"h1\", { class: \"splash-title\" }, \"ご注文はうさぎですか？\"),\n                                    _createElementVNode(\"p\", { class: \"splash-subtitle\" }, \"请问您今天要来点兔子吗？\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"press-start-btn animate-fadeInUp\",\n                                    onClick: handleStart\n                                }, [...(_cache[28] || (_cache[28] = [\n                                        _createElementVNode(\"span\", { class: \"animate-pulse\" }, \"PRESS START\", -1 /* CACHED */)\n                                    ]))])\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                }),\n                _cache[68] || (_cache[68] = _createElementVNode(\"h1\", {\n                    id: \"page-main-title\",\n                    class: \"sr-only\"\n                }, \"点兔文字交互主页面\", -1 /* CACHED */)),\n                _createElementVNode(\"header\", _hoisted_3, [\n                    _cache[33] || (_cache[33] = _createElementVNode(\"div\", {\n                        id: \"brand-logo-wrap\",\n                        \"aria-label\": \"品牌标识\"\n                    }, [\n                        _createElementVNode(\"span\", { class: \"brand-main\" }, \"叙事界面\"),\n                        _createElementVNode(\"small\", { class: \"brand-sub\" }, \"沉浸式文字交互\")\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"nav\", _hoisted_4, [\n                        _createElementVNode(\"button\", {\n                            id: \"btn-open-tab-history\",\n                            type: \"button\",\n                            class: \"btn nav-btn\",\n                            onClick: _cache[0] || (_cache[0] = ($event) => (openFeatureModal('history')))\n                        }, [...(_cache[30] || (_cache[30] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"fa-solid fa-clock-rotate-left\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createElementVNode(\"span\", null, \"历史\", -1 /* CACHED */)\n                            ]))]),\n                        _createElementVNode(\"button\", {\n                            id: \"btn-open-tab-worldbook\",\n                            type: \"button\",\n                            class: \"btn nav-btn\",\n                            onClick: _cache[1] || (_cache[1] = ($event) => (openFeatureModal('worldbook')))\n                        }, [...(_cache[31] || (_cache[31] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"fa-solid fa-book-open\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createElementVNode(\"span\", null, \"世界书\", -1 /* CACHED */)\n                            ]))]),\n                        _createElementVNode(\"button\", {\n                            id: \"btn-open-tab-settings\",\n                            type: \"button\",\n                            class: \"btn nav-btn\",\n                            onClick: _cache[2] || (_cache[2] = ($event) => (openFeatureModal('settings')))\n                        }, [...(_cache[32] || (_cache[32] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"fa-solid fa-gear\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createElementVNode(\"span\", null, \"设置\", -1 /* CACHED */)\n                            ]))])\n                    ])\n                ]),\n                _createElementVNode(\"main\", _hoisted_5, [\n                    _createElementVNode(\"section\", _hoisted_6, [\n                        _createElementVNode(\"div\", { class: \"panel-head-row\" }, [\n                            _cache[34] || (_cache[34] = _createElementVNode(\"h2\", { id: \"heading-story-feed\" }, \"叙事消息\", -1 /* CACHED */)),\n                            _createElementVNode(\"button\", {\n                                id: \"btn-refresh-story\",\n                                type: \"button\",\n                                class: \"btn panel-mini-btn\",\n                                onClick: refreshLatestAssistantMessage\n                            }, \" 同步楼层 \")\n                        ]),\n                        _createElementVNode(\"article\", {\n                            id: \"story-current-message\",\n                            \"aria-live\": \"polite\",\n                            \"aria-busy\": isBusyGenerating.value ? 'true' : 'false'\n                        }, _toDisplayString(displayedMessage.value), 9 /* TEXT, PROPS */, _hoisted_7)\n                    ]),\n                    _createElementVNode(\"section\", _hoisted_8, [\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _cache[35] || (_cache[35] = _createElementVNode(\"h2\", { id: \"heading-option-actions\" }, \"可选行动\", -1 /* CACHED */)),\n                            (isBusyGenerating.value)\n                                ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, \"正在生成回复\"))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"ul\", _hoisted_11, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(options.value, (option, index) => {\n                                return (_openBlock(), _createElementBlock(\"li\", {\n                                    key: option.id\n                                }, [\n                                    _createElementVNode(\"button\", {\n                                        id: `option-card-${String(index + 1).padStart(3, '0')}`,\n                                        class: \"btn option-card\",\n                                        type: \"button\",\n                                        disabled: isBusyGenerating.value,\n                                        onClick: ($event) => (handleOption(option.content))\n                                    }, [\n                                        _createElementVNode(\"strong\", null, _toDisplayString(option.title), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(option.content), 1 /* TEXT */)\n                                    ], 8 /* PROPS */, _hoisted_12)\n                                ]));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_13, [\n                            _cache[36] || (_cache[36] = _createElementVNode(\"label\", {\n                                for: \"input-custom-option\",\n                                class: \"sr-only\"\n                            }, \"自定义选项内容\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                id: \"input-custom-option\",\n                                \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((customOption).value = $event)),\n                                rows: \"2\",\n                                placeholder: \"输入自定义行动...\",\n                                \"aria-label\": \"自定义选项内容\",\n                                disabled: isBusyGenerating.value\n                            }, null, 8 /* PROPS */, _hoisted_14), [\n                                [_vModelText, customOption.value]\n                            ]),\n                            _createElementVNode(\"button\", {\n                                id: \"btn-add-custom-option\",\n                                type: \"button\",\n                                class: \"btn\",\n                                disabled: isBusyGenerating.value,\n                                onClick: submitCustomOption\n                            }, \" 发送行动 \", 8 /* PROPS */, _hoisted_15)\n                        ])\n                    ]),\n                    _createElementVNode(\"aside\", _hoisted_16, [\n                        _cache[37] || (_cache[37] = _createElementVNode(\"div\", { class: \"char-head-row\" }, [\n                            _createElementVNode(\"h2\", { id: \"heading-character-status\" }, \"角色状态\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"ul\", _hoisted_17, [\n                            (_openBlock(), _createElementBlock(_Fragment, null, _renderList(characterProfiles, (item) => {\n                                return _createElementVNode(\"li\", {\n                                    key: item.key\n                                }, [\n                                    _createElementVNode(\"button\", {\n                                        id: `avatar-item-${item.key}`,\n                                        type: \"button\",\n                                        class: \"btn avatar-chip\",\n                                        style: _normalizeStyle({ '--chip-color': item.color }),\n                                        onClick: ($event) => (openCharacterDetail(item.key))\n                                    }, [\n                                        _createElementVNode(\"span\", _hoisted_19, [\n                                            _createElementVNode(\"img\", {\n                                                id: `avatar-img-${item.key}`,\n                                                class: \"avatar-thumb\",\n                                                src: item.avatarUrl,\n                                                alt: `${item.name}头像`,\n                                                loading: \"lazy\",\n                                                decoding: \"async\",\n                                                onError: ($event) => (onAvatarImageError($event, item.name))\n                                            }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_20)\n                                        ]),\n                                        _createElementVNode(\"span\", _hoisted_21, _toDisplayString(item.name), 1 /* TEXT */)\n                                    ], 12 /* STYLE, PROPS */, _hoisted_18)\n                                ]);\n                            }), 64 /* STABLE_FRAGMENT */))\n                        ])\n                    ])\n                ]),\n                _createElementVNode(\"footer\", _hoisted_22, [\n                    _createElementVNode(\"button\", {\n                        id: \"btn-toggle-fullscreen\",\n                        type: \"button\",\n                        class: \"btn\",\n                        title: \"全屏\",\n                        onClick: toggleFullscreen\n                    }, \"全屏\"),\n                    _createElementVNode(\"button\", {\n                        id: \"btn-toggle-autoscroll\",\n                        type: \"button\",\n                        class: \"btn\",\n                        title: settings.value.autoScroll ? '关闭自动滚动' : '开启自动滚动',\n                        onClick: _cache[4] || (_cache[4] = ($event) => (settings.value.autoScroll = !settings.value.autoScroll))\n                    }, \" 自动滚动 \", 8 /* PROPS */, _hoisted_23),\n                    _createElementVNode(\"button\", {\n                        id: \"btn-toggle-typewriter\",\n                        type: \"button\",\n                        class: \"btn\",\n                        title: \"切换显示模式\",\n                        onClick: toggleDisplayMode\n                    }, \" 显示模式 \"),\n                    _createElementVNode(\"button\", {\n                        id: \"btn-open-feature-modal\",\n                        type: \"button\",\n                        class: \"btn\",\n                        title: \"功能面板\",\n                        onClick: _cache[5] || (_cache[5] = ($event) => (openFeatureModal('history')))\n                    }, \" 功能面板 \")\n                ]),\n                (isFeatureModalVisible.value)\n                    ? (_openBlock(), _createElementBlock(\"section\", {\n                        key: 0,\n                        id: \"layer-feature-modal\",\n                        role: \"dialog\",\n                        \"aria-modal\": \"true\",\n                        \"aria-label\": \"功能面板\",\n                        class: \"modal-scrim\",\n                        onClick: _withModifiers(closeFeatureModal, [\"self\"]),\n                        onKeydown: _cache[26] || (_cache[26] = ($event) => (trapFocusInModal($event, 'layer-feature-modal')))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_24, [\n                            _createElementVNode(\"header\", { class: \"modal-header\" }, [\n                                _cache[38] || (_cache[38] = _createElementVNode(\"h2\", { id: \"modal-feature-title\" }, \"功能面板\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    id: \"btn-close-feature-modal\",\n                                    type: \"button\",\n                                    class: \"btn\",\n                                    onClick: closeFeatureModal\n                                }, \"关闭\")\n                            ]),\n                            _createElementVNode(\"nav\", _hoisted_25, [\n                                _createElementVNode(\"button\", {\n                                    id: \"modal-tab-history\",\n                                    type: \"button\",\n                                    class: _normalizeClass([\"btn\", { active: activeTab.value === 'history' }]),\n                                    onClick: _cache[6] || (_cache[6] = ($event) => (activeTab.value = 'history'))\n                                }, \" 历史消息 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    id: \"modal-tab-worldbook\",\n                                    type: \"button\",\n                                    class: _normalizeClass([\"btn\", { active: activeTab.value === 'worldbook' }]),\n                                    onClick: _cache[7] || (_cache[7] = ($event) => (activeTab.value = 'worldbook'))\n                                }, \" 世界书管理 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    id: \"modal-tab-settings\",\n                                    type: \"button\",\n                                    class: _normalizeClass([\"btn\", { active: activeTab.value === 'settings' }]),\n                                    onClick: _cache[8] || (_cache[8] = ($event) => (activeTab.value = 'settings'))\n                                }, \" 设置 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    id: \"modal-tab-character\",\n                                    type: \"button\",\n                                    class: _normalizeClass([\"btn\", { active: activeTab.value === 'character' }]),\n                                    onClick: _cache[9] || (_cache[9] = ($event) => (activeTab.value = 'character'))\n                                }, \" 角色详情 \", 2 /* CLASS */)\n                            ]),\n                            (activeTab.value === 'history')\n                                ? (_openBlock(), _createElementBlock(\"section\", _hoisted_26, [\n                                    _cache[40] || (_cache[40] = _createElementVNode(\"h3\", null, \"历史消息\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_27, [\n                                        _cache[39] || (_cache[39] = _createElementVNode(\"label\", {\n                                            for: \"input-history-search\",\n                                            class: \"sr-only\"\n                                        }, \"搜索历史消息\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            id: \"input-history-search\",\n                                            \"onUpdate:modelValue\": _cache[10] || (_cache[10] = ($event) => ((historyQuery).value = $event)),\n                                            type: \"search\",\n                                            placeholder: \"输入关键字筛选历史消息\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [\n                                                _vModelText,\n                                                historyQuery.value,\n                                                void 0,\n                                                { trim: true }\n                                            ]\n                                        ]),\n                                        _createElementVNode(\"button\", {\n                                            id: \"btn-history-refresh\",\n                                            type: \"button\",\n                                            class: \"btn\",\n                                            onClick: _cache[11] || (_cache[11] = ($event) => (loadHistory(true)))\n                                        }, \"刷新\")\n                                    ]),\n                                    _createElementVNode(\"ul\", _hoisted_28, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(historyFilteredMessages.value, (msg) => {\n                                            return (_openBlock(), _createElementBlock(\"li\", {\n                                                key: `history-${msg.message_id}`\n                                            }, [\n                                                _createElementVNode(\"article\", {\n                                                    id: `history-item-${msg.message_id}`,\n                                                    class: \"history-card\"\n                                                }, [\n                                                    _createElementVNode(\"header\", null, [\n                                                        _createElementVNode(\"span\", _hoisted_30, \"第\" + _toDisplayString(msg.message_id) + \"楼\", 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_31, _toDisplayString(roleLabel(msg.role)), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_32, _toDisplayString(msg.name || '未知角色'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"p\", null, _toDisplayString(truncateText(msg.message, 160)), 1 /* TEXT */),\n                                                    _createElementVNode(\"button\", {\n                                                        id: `btn-history-use-${msg.message_id}`,\n                                                        type: \"button\",\n                                                        class: \"btn panel-mini-btn\",\n                                                        onClick: ($event) => (useHistoryAsCustom(msg.message))\n                                                    }, \" 引用到自定义选项 \", 8 /* PROPS */, _hoisted_33)\n                                                ], 8 /* PROPS */, _hoisted_29)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_34, [\n                                        _createElementVNode(\"button\", {\n                                            id: \"btn-history-load-more\",\n                                            type: \"button\",\n                                            class: \"btn\",\n                                            disabled: !historyHasMore.value,\n                                            onClick: loadMoreHistory\n                                        }, \" 加载更多 \", 8 /* PROPS */, _hoisted_35)\n                                    ])\n                                ]))\n                                : (activeTab.value === 'worldbook')\n                                    ? (_openBlock(), _createElementBlock(\"section\", _hoisted_36, [\n                                        _cache[43] || (_cache[43] = _createElementVNode(\"h3\", null, \"世界书管理\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_37, [\n                                            _cache[41] || (_cache[41] = _createElementVNode(\"label\", {\n                                                for: \"select-worldbook\",\n                                                class: \"sr-only\"\n                                            }, \"选择世界书\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"select\", {\n                                                id: \"select-worldbook\",\n                                                \"onUpdate:modelValue\": _cache[12] || (_cache[12] = ($event) => ((selectedWorldbookName).value = $event))\n                                            }, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(worldbookNames.value, (name) => {\n                                                    return (_openBlock(), _createElementBlock(\"option\", {\n                                                        key: name,\n                                                        value: name\n                                                    }, _toDisplayString(name), 9 /* TEXT, PROPS */, _hoisted_38));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ], 512 /* NEED_PATCH */), [\n                                                [_vModelSelect, selectedWorldbookName.value]\n                                            ]),\n                                            _cache[42] || (_cache[42] = _createElementVNode(\"label\", {\n                                                for: \"input-worldbook-search\",\n                                                class: \"sr-only\"\n                                            }, \"搜索世界书条目\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                id: \"input-worldbook-search\",\n                                                \"onUpdate:modelValue\": _cache[13] || (_cache[13] = ($event) => ((worldbookQuery).value = $event)),\n                                                type: \"search\",\n                                                placeholder: \"搜索条目名称或内容\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [\n                                                    _vModelText,\n                                                    worldbookQuery.value,\n                                                    void 0,\n                                                    { trim: true }\n                                                ]\n                                            ]),\n                                            _createElementVNode(\"button\", {\n                                                id: \"btn-worldbook-refresh\",\n                                                type: \"button\",\n                                                class: \"btn\",\n                                                onClick: reloadWorldbook\n                                            }, \"刷新\")\n                                        ]),\n                                        (worldbookError.value)\n                                            ? (_openBlock(), _createElementBlock(\"p\", _hoisted_39, _toDisplayString(worldbookError.value), 1 /* TEXT */))\n                                            : (isWorldbookLoading.value)\n                                                ? (_openBlock(), _createElementBlock(\"p\", _hoisted_40, \"世界书读取中...\"))\n                                                : _createCommentVNode(\"v-if\", true),\n                                        _createElementVNode(\"ul\", _hoisted_41, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(filteredWorldbookEntries.value, (entry) => {\n                                                return (_openBlock(), _createElementBlock(\"li\", {\n                                                    key: entry.uid\n                                                }, [\n                                                    _createElementVNode(\"article\", {\n                                                        id: `worldbook-entry-${entry.uid}`,\n                                                        class: \"worldbook-card\"\n                                                    }, [\n                                                        _createElementVNode(\"header\", null, [\n                                                            _createElementVNode(\"strong\", null, _toDisplayString(entry.name || `未命名条目-${entry.uid}`), 1 /* TEXT */),\n                                                            _createElementVNode(\"button\", {\n                                                                id: `btn-worldbook-toggle-${entry.uid}`,\n                                                                type: \"button\",\n                                                                class: \"btn panel-mini-btn\",\n                                                                onClick: ($event) => (toggleWorldbookEntryState(entry.uid, !entry.enabled))\n                                                            }, _toDisplayString(entry.enabled ? '已启用' : '已禁用'), 9 /* TEXT, PROPS */, _hoisted_43)\n                                                        ]),\n                                                        _createElementVNode(\"p\", null, _toDisplayString(truncateText(entry.content, 120)), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_44, [\n                                                            _createElementVNode(\"span\", null, \"策略：\" + _toDisplayString(entry.strategy.type), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, \"概率：\" + _toDisplayString(entry.probability) + \"%\", 1 /* TEXT */)\n                                                        ])\n                                                    ], 8 /* PROPS */, _hoisted_42)\n                                                ]));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                                    : (activeTab.value === 'settings')\n                                        ? (_openBlock(), _createElementBlock(\"section\", _hoisted_45, [\n                                            _cache[58] || (_cache[58] = _createElementVNode(\"h3\", null, \"设置\", -1 /* CACHED */)),\n                                            _createElementVNode(\"form\", {\n                                                id: \"form-ui-settings\",\n                                                class: \"settings-grid\",\n                                                onSubmit: _cache[24] || (_cache[24] = _withModifiers(() => { }, [\"prevent\"]))\n                                            }, [\n                                                _createElementVNode(\"fieldset\", _hoisted_46, [\n                                                    _cache[46] || (_cache[46] = _createElementVNode(\"legend\", null, \"主题风格\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-theme-latte\",\n                                                            \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event) => ((settings.value.theme) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"theme-latte-noir\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.theme]\n                                                        ]),\n                                                        _cache[44] || (_cache[44] = _createTextVNode(\" 奶油白昼 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-theme-midnight\",\n                                                            \"onUpdate:modelValue\": _cache[15] || (_cache[15] = ($event) => ((settings.value.theme) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"theme-midnight-salon\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.theme]\n                                                        ]),\n                                                        _cache[45] || (_cache[45] = _createTextVNode(\" 午夜沙龙 \", -1 /* CACHED */))\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"fieldset\", _hoisted_47, [\n                                                    _cache[50] || (_cache[50] = _createElementVNode(\"legend\", null, \"消息显示\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-mode-instant\",\n                                                            \"onUpdate:modelValue\": _cache[16] || (_cache[16] = ($event) => ((settings.value.displayMode) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"instant\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.displayMode]\n                                                        ]),\n                                                        _cache[47] || (_cache[47] = _createTextVNode(\" 即时显示 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-mode-typewriter\",\n                                                            \"onUpdate:modelValue\": _cache[17] || (_cache[17] = ($event) => ((settings.value.displayMode) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"typewriter\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.displayMode]\n                                                        ]),\n                                                        _cache[48] || (_cache[48] = _createTextVNode(\" 打字机 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-mode-segment\",\n                                                            \"onUpdate:modelValue\": _cache[18] || (_cache[18] = ($event) => ((settings.value.displayMode) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"segment\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.displayMode]\n                                                        ]),\n                                                        _cache[49] || (_cache[49] = _createTextVNode(\" 分段显示 \", -1 /* CACHED */))\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"fieldset\", _hoisted_48, [\n                                                    _cache[54] || (_cache[54] = _createElementVNode(\"legend\", null, \"字体大小\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-font-small\",\n                                                            \"onUpdate:modelValue\": _cache[19] || (_cache[19] = ($event) => ((settings.value.fontScale) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"small\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.fontScale]\n                                                        ]),\n                                                        _cache[51] || (_cache[51] = _createTextVNode(\" 小 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-font-medium\",\n                                                            \"onUpdate:modelValue\": _cache[20] || (_cache[20] = ($event) => ((settings.value.fontScale) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"medium\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.fontScale]\n                                                        ]),\n                                                        _cache[52] || (_cache[52] = _createTextVNode(\" 中 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"radio-font-large\",\n                                                            \"onUpdate:modelValue\": _cache[21] || (_cache[21] = ($event) => ((settings.value.fontScale) = $event)),\n                                                            type: \"radio\",\n                                                            value: \"large\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelRadio, settings.value.fontScale]\n                                                        ]),\n                                                        _cache[53] || (_cache[53] = _createTextVNode(\" 大 \", -1 /* CACHED */))\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"fieldset\", _hoisted_49, [\n                                                    _cache[57] || (_cache[57] = _createElementVNode(\"legend\", null, \"交互偏好\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"check-auto-scroll\",\n                                                            \"onUpdate:modelValue\": _cache[22] || (_cache[22] = ($event) => ((settings.value.autoScroll) = $event)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, settings.value.autoScroll]\n                                                        ]),\n                                                        _cache[55] || (_cache[55] = _createTextVNode(\" 自动滚动 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", null, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            id: \"check-reduced-motion\",\n                                                            \"onUpdate:modelValue\": _cache[23] || (_cache[23] = ($event) => ((settings.value.reduceMotion) = $event)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, settings.value.reduceMotion]\n                                                        ]),\n                                                        _cache[56] || (_cache[56] = _createTextVNode(\" 减少动效 \", -1 /* CACHED */))\n                                                    ])\n                                                ])\n                                            ], 32 /* NEED_HYDRATION */),\n                                            _createElementVNode(\"div\", { class: \"panel-actions-row\" }, [\n                                                _createElementVNode(\"button\", {\n                                                    id: \"btn-reset-settings\",\n                                                    type: \"button\",\n                                                    class: \"btn\",\n                                                    onClick: resetSettings\n                                                }, \"重置默认设置\")\n                                            ])\n                                        ]))\n                                        : (_openBlock(), _createElementBlock(\"section\", _hoisted_50, [\n                                            _cache[63] || (_cache[63] = _createElementVNode(\"h3\", null, \"角色详情\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_51, [\n                                                _createElementVNode(\"ul\", _hoisted_52, [\n                                                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(characterProfiles, (item) => {\n                                                        return _createElementVNode(\"li\", {\n                                                            key: `detail-${item.key}`\n                                                        }, [\n                                                            _createElementVNode(\"button\", {\n                                                                id: `btn-character-focus-${item.key}`,\n                                                                type: \"button\",\n                                                                class: _normalizeClass([\"btn\", { active: activeCharacterKey.value === item.key }]),\n                                                                onClick: ($event) => (activeCharacterKey.value = item.key)\n                                                            }, _toDisplayString(item.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_53)\n                                                        ]);\n                                                    }), 64 /* STABLE_FRAGMENT */))\n                                                ]),\n                                                _createElementVNode(\"article\", _hoisted_54, [\n                                                    _createElementVNode(\"div\", _hoisted_55, [\n                                                        _createElementVNode(\"img\", {\n                                                            id: \"img-character-detail\",\n                                                            src: activeCharacter.value.avatarUrl,\n                                                            alt: `${activeCharacter.value.name}立绘`,\n                                                            loading: \"lazy\",\n                                                            decoding: \"async\",\n                                                            onError: _cache[25] || (_cache[25] = ($event) => (onAvatarImageError($event, activeCharacter.value.name)))\n                                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_56)\n                                                    ]),\n                                                    _createElementVNode(\"h4\", null, _toDisplayString(activeCharacter.value.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"p\", null, _toDisplayString(activeCharacter.value.summary), 1 /* TEXT */),\n                                                    _createElementVNode(\"dl\", null, [\n                                                        _cache[59] || (_cache[59] = _createElementVNode(\"dt\", null, \"心情\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"dd\", null, _toDisplayString(activeCharacterState.value.mood), 1 /* TEXT */),\n                                                        _cache[60] || (_cache[60] = _createElementVNode(\"dt\", null, \"位置\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"dd\", null, _toDisplayString(activeCharacterState.value.location), 1 /* TEXT */),\n                                                        _cache[61] || (_cache[61] = _createElementVNode(\"dt\", null, \"着装\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"dd\", null, _toDisplayString(activeCharacterState.value.outfit), 1 /* TEXT */),\n                                                        _cache[62] || (_cache[62] = _createElementVNode(\"dt\", null, \"关系\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"dd\", null, _toDisplayString(activeCharacterState.value.relation), 1 /* TEXT */)\n                                                    ])\n                                                ])\n                                            ])\n                                        ]))\n                        ])\n                    ], 32 /* NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true),\n                (showPerspectiveSelector.value)\n                    ? (_openBlock(), _createElementBlock(\"section\", {\n                        key: 1,\n                        id: \"layer-perspective-modal\",\n                        role: \"dialog\",\n                        \"aria-modal\": \"true\",\n                        \"aria-label\": \"主视角选择\",\n                        class: \"modal-scrim perspective\",\n                        onKeydown: _cache[27] || (_cache[27] = ($event) => (trapFocusInModal($event, 'layer-perspective-modal')))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_57, [\n                            _cache[65] || (_cache[65] = _createElementVNode(\"header\", { class: \"modal-header\" }, [\n                                _createElementVNode(\"h2\", { id: \"heading-perspective-selector\" }, \"请选择主视角\")\n                            ], -1 /* CACHED */)),\n                            _cache[66] || (_cache[66] = _createElementVNode(\"p\", { class: \"perspective-tip\" }, \"首次进入当前聊天且最高楼层为0时，需要先选择主视角后再发送行动。\", -1 /* CACHED */)),\n                            _createElementVNode(\"ul\", _hoisted_58, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(perspectiveEntries.value, (item) => {\n                                    return (_openBlock(), _createElementBlock(\"li\", {\n                                        key: item.key\n                                    }, [\n                                        _createElementVNode(\"button\", {\n                                            id: `btn-select-perspective-${item.key}`,\n                                            type: \"button\",\n                                            class: _normalizeClass([\"btn perspective-card\", { active: selectedPerspective.value === item.key }]),\n                                            onClick: ($event) => (selectedPerspective.value = item.key)\n                                        }, [\n                                            _createElementVNode(\"strong\", null, _toDisplayString(item.key), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, _toDisplayString(item.description), 1 /* TEXT */)\n                                        ], 10 /* CLASS, PROPS */, _hoisted_59)\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_60, [\n                                _cache[64] || (_cache[64] = _createElementVNode(\"h3\", { id: \"heading-opening-preview\" }, \"开场白预览\", -1 /* CACHED */)),\n                                _createElementVNode(\"p\", _hoisted_61, _toDisplayString(selectedOpeningPreview.value), 1 /* TEXT */)\n                            ]),\n                            _createElementVNode(\"button\", {\n                                id: \"btn-confirm-perspective\",\n                                type: \"button\",\n                                class: \"btn confirm-btn\",\n                                disabled: !selectedPerspective.value,\n                                onClick: confirmPerspective\n                            }, \" 确认主视角 \", 8 /* PROPS */, _hoisted_62)\n                        ])\n                    ], 32 /* NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 12 /* STYLE, PROPS */, _hoisted_1));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport { createApp } from 'vue';\nimport App from './App.vue';\nimport './main.css';\n\n$(() => {\n  const app = createApp(App).use(createPinia());\n  app.mount('#app');\n  $(window).on('pagehide', () => app.unmount());\n});\n"],"names":["Vue","perspectives","description","opening","_hoisted_1","_hoisted_2","key","class","_hoisted_3","id","role","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","tabindex","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","SETTINGS_STORAGE_KEY","PERSPECTIVE_VAR_PATH","__name","setup","__props","perspectiveKeys","fallbackOpeningConfig","defaultSettings","theme","displayMode","fontScale","autoScroll","reduceMotion","catboxImage","code","characterProfiles","name","color","avatarUrl","summary","mood","location","outfit","relation","perspectiveToCharacter","truncateText","text","max","length","slice","onAvatarImageError","event","characterName","target","onerror","src","encodeURIComponent","openingConfig","input","base","_","cloneDeep","raw","forEach","candidate","trim","normalizeOpeningConfig","settings","ref","localStorage","getItem","parsed","JSON","parse","loadSettings","isFeatureModalVisible","activeTab","showPerspectiveSelector","isSplashScreenVisible","selectedPerspective","perspectiveConfirmed","customOption","isFullscreen","isBusyGenerating","rawCurrentMessage","displayedMessage","activeCharacterKey","chatVariablesSnapshot","historyMessages","historyDepth","historyQuery","worldbookNames","selectedWorldbookName","worldbookEntries","worldbookQuery","worldbookError","isWorldbookLoading","lastMessageId","options","title","content","fontScaleMap","small","medium","large","pageRootStyle","computed","value","perspectiveEntries","map","selectedOpeningPreview","historyFilteredMessages","keyword","toLowerCase","sorted","sort","lhs","rhs","message_id","filter","msg","message","includes","historyHasMore","filteredWorldbookEntries","entry","activeCharacter","find","item","activeCharacterState","profile","vars","get","String","eventStops","typewriterTimer","lastFocusedElement","clearTypewriterTimer","window","clearInterval","saveSettings","setItem","stringify","resetSettings","toastr","success","toggleDisplayMode","chain","index","indexOf","readPerspectiveFromChatVariables","getVariables","type","isPerspectiveKey","syncLastMessageId","getLastMessageId","getPerspectiveOpening","confirmPerspective","updateVariablesWith","set","error","console","warn","persistPerspectiveToChatVariables","mapped","updateOptionsFromMessage","loadHistory","reset","lastId","range","Math","getChatMessages","hide_state","loadMoreHistory","async","loadWorldbookEntries","getWorldbook","reloadWorldbook","names","bind","getCharWorldbookNames","push","primary","additional","Boolean","getWorldbookNames","Array","from","Set","loadWorldbookNames","refreshChatVariablesSnapshot","dynamic","block","match","matchAll","extractRoleplayOptions","refreshLatestAssistantMessage","start","latest","at","handleOption","clean","isFirstTurn","createChatMessages","result","generate","user_input","should_stream","overrides","chat_history","prompts","undefined","document","getElementById","scrollIntoView","behavior","scrollStoryIfNeeded","warning","info","submitCustomOption","unshift","Date","now","toggleFullscreen","fullscreenElement","documentElement","requestFullscreen","exitFullscreen","handleStart","focusCurrentModalFirstItem","nextTick","selector","focus","openFeatureModal","tab","activeElement","HTMLElement","closeFeatureModal","trapFocusInModal","modalId","modal","focusable","querySelectorAll","hasAttribute","first","last","shiftKey","preventDefault","onGlobalKeydown","initializeForCurrentChat","cachedPerspective","watch","deep","replace","chars","setInterval","join","applyDisplayMessage","immediate","onMounted","meta","head","querySelector","createElement","appendChild","upsertMetaDescription","addEventListener","eventOn","tavern_events","MESSAGE_RECEIVED","stop","MESSAGE_EDITED","MESSAGE_SWIPED","CHAT_CHANGED","WORLDINFO_UPDATED","onBeforeUnmount","removeEventListener","_ctx","_cache","style","default","onClick","$event","option","padStart","disabled","for","rows","placeholder","characterKey","alt","loading","decoding","onError","onKeydown","active","uid","enabled","updateWorldbookWith","entries","strategy","probability","onSubmit","$","app","createApp","App","use","mount","on","unmount"],"sourceRoot":""}