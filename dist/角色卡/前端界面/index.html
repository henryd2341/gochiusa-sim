<head><script type="module">import{createPinia as e}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';const t=Vue,a={perspectives:{心爱:{description:'以保登心爱的情绪与语气观察事件发展，优先关注热情、主动与当下氛围。',opening:'你在清晨推开 Rabbit House 的门，熟悉的甜香与轻快脚步声同时向你迎来。'},智乃:{description:'以香风智乃的克制与细腻感知推进剧情，优先关注细节与隐含情绪变化。',opening:'你端正地整理围裙与托盘，抬眼时，门铃正好响起，今天的第一位客人到了。'},理世:{description:'以天天座理世的执行力推进剧情，优先处理秩序、任务与突发状况。',opening:'你快速扫视店内座位与动线，确认一切就绪后，今天的营业正式开始。'},千夜:{description:'以宇治松千夜的温婉风格观察互动，优先关注礼节、安抚与氛围调和。',opening:'你轻轻摆好茶点，窗外风铃声细微晃动，一段柔和却重要的对话即将开始。'},纱路:{description:'以桐间纱路的谨慎与责任感参与剧情，优先关注风险与规则边界。',opening:'你深呼吸后推门而入，尽量让自己的步伐显得从容，不让紧张暴露在表情里。'},无:{description:'使用中立视角，不绑定具体角色语气，更适合观察多角色并行叙事。',opening:'午后钟声落下，你推门进入熟悉的咖啡馆，空气里有甜点与咖啡的暖香。'}}},l=['data-theme','data-reduced-motion'],n={key:0,class:'splash-screen'},o={id:'region-top-nav',role:'banner','aria-label':'顶部导航'},r={id:'nav-feature-entry','aria-label':'功能入口'},i={id:'region-main-content',role:'main'},c={id:'panel-story-feed','aria-labelledby':'heading-story-feed',class:'card panel-story'},s=['aria-busy'],d={id:'panel-option-actions','aria-labelledby':'heading-option-actions',class:'card panel-options'},u={class:'panel-head-row'},m={key:0,id:'status-generating',class:'status-chip','aria-live':'assertive'},p={id:'list-option-cards',class:'option-list'},v=['id','disabled','onClick'],y={class:'custom-option-row'},b=['disabled'],g=['disabled'],h={id:'panel-character-status','aria-labelledby':'heading-character-status',class:'card panel-characters'},E={id:'list-character-avatars',class:'avatar-list'},f=['id','onClick'],V={class:'avatar-thumb-wrap','aria-hidden':'true'},N=['id','src','alt','onError'],k={class:'avatar-name'},w={id:'region-quick-actions','aria-label':'快捷操作',class:'quick-actions'},S=['title'],C={class:'modal-shell',tabindex:'-1'},M={class:'tab-nav','aria-label':'功能标签页'},B={key:0,id:'panel-tab-history',class:'tab-panel','aria-live':'polite'},D={class:'panel-tools'},x={id:'list-history-messages',class:'history-list'},U=['id'],T={class:'badge'},I={class:'badge muted'},L={class:'badge muted'},A=['id','onClick'],R={class:'panel-actions-row'},F=['disabled'],O={key:1,id:'panel-tab-worldbook',class:'tab-panel','aria-live':'polite'},W={class:'panel-tools'},q=['value'],j={key:0,class:'inline-error'},G={key:1,class:'inline-tip'},H={id:'list-worldbook-entries',class:'worldbook-list'},K=['id'],P=['id','onClick'],J={class:'entry-meta'},Q={key:2,id:'panel-tab-settings',class:'tab-panel','aria-live':'polite'},X={class:'setting-group'},Y={class:'setting-group'},Z={class:'setting-group'},ee={class:'setting-group'},te={key:3,id:'panel-tab-character',class:'tab-panel','aria-live':'polite'},ae={class:'character-panel'},le={class:'character-selector'},ne=['id','onClick'],oe={id:'panel-character-detail-card',class:'character-detail-card'},re={class:'character-hero','aria-hidden':'true'},ie=['src','alt'],ce={class:'modal-shell perspective-shell',tabindex:'-1'},se={class:'perspective-list'},de=['id','onClick'],ue={class:'opening-preview-wrap','aria-live':'polite'},me={id:'text-opening-preview'},pe=['disabled'],ve='gochiusa.frontend.settings.v2',ye='前端界面.主视角',be=(0,t.defineComponent)({__name:'App',setup(e){const be=['心爱','智乃','理世','千夜','纱路','无'],ge={perspectives:{心爱:{description:'以保登心爱的情绪与语气观察事件发展，优先关注热情、主动与当下氛围。',opening:'你在清晨推开兔屋咖啡馆的大门，熟悉的甜香与轻快脚步声同时向你迎来。'},智乃:{description:'以香风智乃的克制与细腻感知推进剧情，优先关注细节与隐含情绪变化。',opening:'你端正地整理围裙与托盘，抬眼时，门铃正好响起，今天的第一位客人到了。'},理世:{description:'以天天座理世的执行力推进剧情，优先处理秩序、任务与突发状况。',opening:'你快速扫视店内座位与动线，确认一切就绪后，今天的营业正式开始。'},千夜:{description:'以宇治松千夜的温婉风格观察互动，优先关注礼节、安抚与氛围调和。',opening:'你轻轻摆好茶点，窗外风铃声细微晃动，一段柔和却重要的对话即将开始。'},纱路:{description:'以桐间纱路的谨慎与责任感参与剧情，优先关注风险与规则边界。',opening:'你深呼吸后推门而入，尽量让自己的步伐显得从容，不让紧张暴露在表情里。'},无:{description:'使用中立视角，不绑定具体角色语气，更适合观察多角色并行叙事。',opening:'午后钟声落下，你推门进入熟悉的咖啡馆，空气里有甜点与咖啡的暖香。'}}},he={theme:'theme-latte-noir',displayMode:'instant',fontScale:'medium',autoScroll:!0,reduceMotion:!1};function Ee(e){return`https://files.catbox.moe/${e}.png`}const fe=[{key:'cocoa',name:'保登心爱',color:'var(--clr-cocoa)',avatarUrl:Ee('qjltca'),summary:'活力型引导角色，擅长快速拉近关系并推动场景气氛。',mood:'开朗',location:'兔屋咖啡馆前厅',outfit:'咖啡厅制服',relation:'友好'},{key:'chino',name:'香风智乃',color:'var(--clr-chino)',avatarUrl:Ee('6t09pw'),summary:'观察型角色，擅长在安静场景中提供高价值细节。',mood:'冷静',location:'吧台内侧',outfit:'咖啡厅制服',relation:'信任建立中'},{key:'rize',name:'天天座理世',color:'var(--clr-rize)',avatarUrl:Ee('n9szhx'),summary:'执行型角色，擅长处理节奏与秩序相关场景。',mood:'专注',location:'点单与出餐动线',outfit:'咖啡厅制服',relation:'可靠同伴'},{key:'chiya',name:'宇治松千夜',color:'var(--clr-chiya)',avatarUrl:Ee('v4spnt'),summary:'情绪调和型角色，擅长缓冲冲突与提升舒适感。',mood:'温和',location:'甜点展示区',outfit:'和风改良制服',relation:'亲近'},{key:'syaro',name:'桐间纱路',color:'var(--clr-syaro)',avatarUrl:Ee('b982xz'),summary:'谨慎型角色，适合调查、推理与高压交互场景。',mood:'紧张但坚定',location:'门厅与过道',outfit:'学院日常装',relation:'逐步加深'}],Ve={心爱:'cocoa',智乃:'chino',理世:'rize',千夜:'chiya',纱路:'syaro',无:'cocoa'};function Ne(e,t=120){return e.length<=t?e:`${e.slice(0,t)}...`}function ke(e,t){const a=e.target;a&&(a.onerror=null,a.src=`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(t)}`)}const we=function(e){const t=_.cloneDeep(ge);if(!e||'object'!=typeof e)return t;const a=e.perspectives;return a&&'object'==typeof a?(be.forEach(e=>{const l=a[e];l&&'string'==typeof l.description&&l.description.trim().length>0&&'string'==typeof l.opening&&l.opening.trim().length>0&&(t.perspectives[e]={description:l.description,opening:l.opening})}),t):t}(a),Se=(0,t.ref)(function(){try{const e=localStorage.getItem(ve);if(!e)return he;const t=JSON.parse(e);return{theme:'theme-midnight-salon'===t.theme?'theme-midnight-salon':'theme-latte-noir',displayMode:'typewriter'===t.displayMode||'segment'===t.displayMode?t.displayMode:'instant',fontScale:'small'===t.fontScale||'large'===t.fontScale?t.fontScale:'medium',autoScroll:!1!==t.autoScroll,reduceMotion:!0===t.reduceMotion}}catch{return he}}()),Ce=((0,t.ref)(!1),(0,t.ref)(!1)),Me=(0,t.ref)('history'),Be=(0,t.ref)(!1),De=(0,t.ref)(!0),$e=(0,t.ref)(null),_e=(0,t.ref)(!1),xe=(0,t.ref)(''),Ue=(0,t.ref)(!1),Te=(0,t.ref)(!1),Ie=(0,t.ref)('正在等待剧情推进，请选择下一步行动。'),Le=(0,t.ref)('正在等待剧情推进，请选择下一步行动。'),ze=(0,t.ref)('cocoa'),Ae=(0,t.ref)({}),Re=(0,t.ref)([]),Fe=(0,t.ref)(40),Oe=(0,t.ref)(''),We=(0,t.ref)([]),qe=(0,t.ref)(''),je=(0,t.ref)([]),Ge=(0,t.ref)(''),He=(0,t.ref)(''),Ke=(0,t.ref)(!1),Pe=(0,t.ref)(0),Je=(0,t.ref)([{id:'opt-001',title:'向柜台点单',content:'你走向柜台，礼貌地询问今日推荐饮品。'},{id:'opt-002',title:'观察店内',content:'你放慢脚步，观察店内客人与角色之间的互动细节。'},{id:'opt-003',title:'主动搭话',content:'你选择与当前出场角色展开一段自然交流。'}]),Qe={small:'0.92',medium:'1',large:'1.08'},Xe=(0,t.computed)(()=>({'--font-scale':Qe[Se.value.fontScale]})),Ye=(0,t.computed)(()=>be.map(e=>({key:e,...we.perspectives[e]}))),Ze=(0,t.computed)(()=>{const e=$e.value;return e?we.perspectives[e].opening:'请选择一个主视角后查看对应开场白。'}),et=((0,t.computed)(()=>'typewriter'===Se.value.displayMode?'显示模式：打字机':'segment'===Se.value.displayMode?'显示模式：分段':'显示模式：即时'),(0,t.computed)(()=>{const e=Oe.value.trim().toLowerCase(),t=[...Re.value].sort((e,t)=>t.message_id-e.message_id);return e?t.filter(t=>`${t.name} ${t.message}`.toLowerCase().includes(e)):t})),tt=(0,t.computed)(()=>Fe.value<Pe.value+1),at=(0,t.computed)(()=>{const e=Ge.value.trim().toLowerCase();return e?je.value.filter(t=>`${t.name} ${t.content}`.toLowerCase().includes(e)):je.value}),lt=(0,t.computed)(()=>fe.find(e=>e.key===ze.value)??fe[0]),nt=(0,t.computed)(()=>{const e=lt.value,t=Ae.value,a=_.get(t,`${e.name}.心情`)??_.get(t,`角色状态.${e.name}.心情`)??_.get(t,`角色.${e.name}.心情`)??e.mood,l=_.get(t,`${e.name}.位置`)??_.get(t,`角色状态.${e.name}.位置`)??_.get(t,`角色.${e.name}.位置`)??e.location,n=_.get(t,`${e.name}.着装`)??_.get(t,`角色状态.${e.name}.着装`)??_.get(t,`角色.${e.name}.着装`)??e.outfit,o=_.get(t,`${e.name}.关系`)??_.get(t,`角色状态.${e.name}.关系`)??_.get(t,`角色.${e.name}.关系`)??e.relation;return{mood:String(a),location:String(l),outfit:String(n),relation:String(o)}}),ot=[];let rt=null,it=null;function ct(){null!==rt&&(window.clearInterval(rt),rt=null)}function st(){localStorage.setItem(ve,JSON.stringify(Se.value))}function dt(){Se.value=_.cloneDeep(he),st(),toastr.success('设置已恢复默认值。')}function ut(){const e=['instant','typewriter','segment'],t=e.indexOf(Se.value.displayMode);Se.value.displayMode=e[(t+1)%e.length]}function mt(){try{const e=getVariables({type:'chat'}),t=_.get(e,ye);return function(e){return be.includes(e)}(t)?t:null}catch{return null}}function pt(){const e=getLastMessageId();return Pe.value=e,e}function vt(){const e=$e.value??'无';return we.perspectives[e].opening}function yt(){if(!$e.value)return;_e.value=!0,Be.value=!1,function(e){try{updateVariablesWith(t=>(_.set(t,ye,e),t),{type:'chat'})}catch(e){console.warn('保存主视角到聊天变量失败:',e)}}($e.value);const e=Ve[$e.value];e&&(ze.value=e),0===pt()&&(Ie.value=vt(),Vt(Ie.value)),toastr.success(`主视角已确定：${$e.value}`)}function bt(e=!1){e&&(Fe.value=40);const t=pt(),a=`${Math.max(0,t-Fe.value+1)}-${t}`;Re.value=getChatMessages(a,{hide_state:'unhidden'})}function gt(){Fe.value+=40,bt(!1)}async function ht(){if(qe.value){Ke.value=!0,He.value='';try{je.value=await getWorldbook(qe.value)}catch(e){He.value='读取世界书失败，请检查绑定状态。',console.error(e)}finally{Ke.value=!1}}else je.value=[]}async function Et(){await async function(){const e=[];try{const t=getCharWorldbookNames('current');e.push(...[t.primary,...t.additional].filter(e=>Boolean(e)))}catch{}if(e.length||e.push(...getWorldbookNames()),We.value=Array.from(new Set(e)),!We.value.length)return qe.value='',void(je.value=[]);We.value.includes(qe.value)||(qe.value=We.value[0])}(),await ht()}function ft(){try{Ae.value=getVariables({type:'chat'})}catch{Ae.value={}}}function Vt(e){const t=function(e){const t=e.match(/<roleplay_options>([\s\S]*?)<\/roleplay_options>/i)?.[1]??'';return t.trim()?[...t.matchAll(/(.+?)[:：]\s*(.+)/g)].map((e,t)=>({id:`opt-dynamic-${t+1}`,title:e[1].trim(),content:e[2].trim()})):[]}(e);t.length>0&&(Je.value=t)}function Nt(){const e=pt(),t=Math.max(0,e-80),a=getChatMessages(`${t}-${e}`,{role:'assistant',hide_state:'unhidden'}).at(-1);a&&'string'==typeof a.message&&(Ie.value=a.message,Vt(a.message))}async function kt(e){const t=e.trim();if(t)if(!Be.value&&_e.value){if(!Te.value){Te.value=!0;try{const e=0===pt();await createChatMessages([{role:'user',message:t}]);const a=await generate({user_input:t,should_stream:!1,overrides:e?{chat_history:{prompts:[{role:'assistant',content:vt()}]}}:void 0}),l=getChatMessages(-1)[0];l&&'assistant'===l.role||await createChatMessages([{role:'assistant',message:a}]),Ie.value=a,Nt(),Vt(a),pt(),bt(!1),ft(),function(){if(!Se.value.autoScroll)return;const e=document.getElementById('story-current-message');e?.scrollIntoView({behavior:Se.value.reduceMotion?'auto':'smooth',block:'nearest'})}()}catch(e){toastr.error('发送选项或生成回复失败。'),console.error(e)}finally{Te.value=!1}}}else toastr.warning('请先完成主视角选择。');else toastr.info('选项内容为空，无法发送。')}async function wt(){const e=xe.value.trim();e?(Je.value.unshift({id:`opt-custom-${Date.now()}`,title:'自定义行动',content:e}),xe.value='',await kt(e)):toastr.info('请先填写自定义选项内容。')}async function St(){try{if(!document.fullscreenElement)return await document.documentElement.requestFullscreen(),void(Ue.value=!0);await document.exitFullscreen(),Ue.value=!1}catch(e){toastr.warning('当前环境不支持全屏切换。'),console.warn(e)}}function Ct(){De.value=!1}function Mt(){(0,t.nextTick)(()=>{if(Be.value){const e=document.getElementById('btn-select-perspective-心爱')??document.getElementById('btn-confirm-perspective');return void e?.focus()}if(Ce.value){const e=document.getElementById(`modal-tab-${Me.value}`)??document.getElementById('btn-close-feature-modal');e?.focus()}})}function Bt(e){it=document.activeElement instanceof HTMLElement?document.activeElement:null,Me.value=e,Ce.value=!0,Mt()}function Dt(){Ce.value=!1,(0,t.nextTick)(()=>{it?.focus()})}function $t(e,t){if('Tab'!==e.key)return;const a=document.getElementById(t);if(!a)return;const l=[...a.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(e=>!e.hasAttribute('disabled'));if(!l.length)return;const n=l[0],o=l[l.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),n.focus())}function _t(e){'Escape'===e.key&&(Be.value||Ce.value&&Dt())}async function xt(){pt();const e=mt();Be.value=0===pt()&&!e,$e.value=Be.value?e:e??'无',_e.value=!Be.value,!Be.value&&$e.value&&(ze.value=Ve[$e.value]),Nt(),bt(!0),ft(),await Et(),Be.value&&Mt()}return(0,t.watch)(()=>Se.value,()=>{st()},{deep:!0}),(0,t.watch)(()=>[Ie.value,Se.value.displayMode,Se.value.reduceMotion],()=>{!function(e){if(ct(),'instant'===Se.value.displayMode)return void(Le.value=e);if('segment'===Se.value.displayMode)return void(Le.value=(t=e,t.replace(/([。！？!?])(?=[^\n])/g,'$1\n').replace(/\n{3,}/g,'\n\n').trim()));var t;const a=Array.from(e);Le.value='';let l=0;rt=window.setInterval(()=>{l+=1,Le.value=a.slice(0,l).join(''),l>=a.length&&ct()},Se.value.reduceMotion?8:20)}(Ie.value)},{immediate:!0}),(0,t.watch)(Me,e=>{'history'!==e?'worldbook'!==e?'character'===e&&ft():Et():bt(!1)}),(0,t.watch)(qe,()=>{ht()}),(0,t.onMounted)(()=>{document.title='点兔文字交互界面',function(e){let t=document.head.querySelector('meta[name="description"]');t||(t=document.createElement('meta'),t.name='description',document.head.appendChild(t)),t.content=e}('高沉浸文字互动体验，支持选项驱动叙事、世界书联动与主视角开场注入。'),document.addEventListener('keydown',_t),xt(),ot.push(eventOn(tavern_events.MESSAGE_RECEIVED,()=>{pt(),Nt(),bt(!1),ft()}).stop),ot.push(eventOn(tavern_events.MESSAGE_EDITED,()=>{pt(),Nt(),bt(!1)}).stop),ot.push(eventOn(tavern_events.MESSAGE_SWIPED,()=>{pt(),Nt()}).stop),ot.push(eventOn(tavern_events.CHAT_CHANGED,()=>{xt(),toastr.info('检测到聊天切换，界面数据已自动同步。')}).stop),ot.push(eventOn(tavern_events.WORLDINFO_UPDATED,()=>{Et()}).stop)}),(0,t.onBeforeUnmount)(()=>{ct(),document.removeEventListener('keydown',_t),ot.forEach(e=>e())}),(e,a)=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{id:'page-game-root','data-theme':Se.value.theme,'data-font':'font-ui-default','data-reduced-motion':Se.value.reduceMotion?'true':'false',style:(0,t.normalizeStyle)(Xe.value)},[a[67]||(a[67]=(0,t.createElementVNode)('div',{class:'background-layer'},[(0,t.createElementVNode)('div',{class:'bg-gradient'})],-1)),(0,t.createVNode)(t.Transition,{name:'fade'},{default:(0,t.withCtx)(()=>[De.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',n,[a[29]||(a[29]=(0,t.createElementVNode)('div',{class:'splash-logo animate-fadeInDown'},[(0,t.createElementVNode)('h1',{class:'splash-title'},'ご注文はうさぎですか？'),(0,t.createElementVNode)('p',{class:'splash-subtitle'},'请问您今天要来点兔子吗？')],-1)),(0,t.createElementVNode)('button',{class:'press-start-btn animate-fadeInUp',onClick:Ct},[...a[28]||(a[28]=[(0,t.createElementVNode)('span',{class:'animate-pulse'},'PRESS START',-1)])])])):(0,t.createCommentVNode)('v-if',!0)]),_:1}),a[68]||(a[68]=(0,t.createElementVNode)('h1',{id:'page-main-title',class:'sr-only'},'点兔文字交互主页面',-1)),(0,t.createElementVNode)('header',o,[a[33]||(a[33]=(0,t.createElementVNode)('div',{id:'brand-logo-wrap','aria-label':'品牌标识'},[(0,t.createElementVNode)('span',{class:'brand-main'},'叙事界面'),(0,t.createElementVNode)('small',{class:'brand-sub'},'沉浸式文字交互')],-1)),(0,t.createElementVNode)('nav',r,[(0,t.createElementVNode)('button',{id:'btn-open-tab-history',type:'button',class:'btn nav-btn',onClick:a[0]||(a[0]=e=>Bt('history'))},[...a[30]||(a[30]=[(0,t.createElementVNode)('i',{class:'fa-solid fa-clock-rotate-left','aria-hidden':'true'},null,-1),(0,t.createElementVNode)('span',null,'历史',-1)])]),(0,t.createElementVNode)('button',{id:'btn-open-tab-worldbook',type:'button',class:'btn nav-btn',onClick:a[1]||(a[1]=e=>Bt('worldbook'))},[...a[31]||(a[31]=[(0,t.createElementVNode)('i',{class:'fa-solid fa-book-open','aria-hidden':'true'},null,-1),(0,t.createElementVNode)('span',null,'世界书',-1)])]),(0,t.createElementVNode)('button',{id:'btn-open-tab-settings',type:'button',class:'btn nav-btn',onClick:a[2]||(a[2]=e=>Bt('settings'))},[...a[32]||(a[32]=[(0,t.createElementVNode)('i',{class:'fa-solid fa-gear','aria-hidden':'true'},null,-1),(0,t.createElementVNode)('span',null,'设置',-1)])])])]),(0,t.createElementVNode)('main',i,[(0,t.createElementVNode)('section',c,[(0,t.createElementVNode)('div',{class:'panel-head-row'},[a[34]||(a[34]=(0,t.createElementVNode)('h2',{id:'heading-story-feed'},'叙事消息',-1)),(0,t.createElementVNode)('button',{id:'btn-refresh-story',type:'button',class:'btn panel-mini-btn',onClick:Nt},' 同步楼层 ')]),(0,t.createElementVNode)('article',{id:'story-current-message','aria-live':'polite','aria-busy':Te.value?'true':'false'},(0,t.toDisplayString)(Le.value),9,s)]),(0,t.createElementVNode)('section',d,[(0,t.createElementVNode)('div',u,[a[35]||(a[35]=(0,t.createElementVNode)('h2',{id:'heading-option-actions'},'可选行动',-1)),Te.value?((0,t.openBlock)(),(0,t.createElementBlock)('span',m,'正在生成回复')):(0,t.createCommentVNode)('v-if',!0)]),(0,t.createElementVNode)('ul',p,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Je.value,(e,a)=>((0,t.openBlock)(),(0,t.createElementBlock)('li',{key:e.id},[(0,t.createElementVNode)('button',{id:`option-card-${String(a+1).padStart(3,'0')}`,class:'btn option-card',type:'button',disabled:Te.value,onClick:t=>kt(e.content)},[(0,t.createElementVNode)('strong',null,(0,t.toDisplayString)(e.title),1),(0,t.createElementVNode)('span',null,(0,t.toDisplayString)(e.content),1)],8,v)]))),128))]),(0,t.createElementVNode)('div',y,[a[36]||(a[36]=(0,t.createElementVNode)('label',{for:'input-custom-option',class:'sr-only'},'自定义选项内容',-1)),(0,t.withDirectives)((0,t.createElementVNode)('textarea',{id:'input-custom-option','onUpdate:modelValue':a[3]||(a[3]=e=>xe.value=e),rows:'2',placeholder:'输入自定义行动...','aria-label':'自定义选项内容',disabled:Te.value},null,8,b),[[t.vModelText,xe.value]]),(0,t.createElementVNode)('button',{id:'btn-add-custom-option',type:'button',class:'btn',disabled:Te.value,onClick:wt},' 发送行动 ',8,g)])]),(0,t.createElementVNode)('aside',h,[a[37]||(a[37]=(0,t.createElementVNode)('div',{class:'char-head-row'},[(0,t.createElementVNode)('h2',{id:'heading-character-status'},'角色状态')],-1)),(0,t.createElementVNode)('ul',E,[((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(fe,e=>(0,t.createElementVNode)('li',{key:e.key},[(0,t.createElementVNode)('button',{id:`avatar-item-${e.key}`,type:'button',class:'btn avatar-chip',style:(0,t.normalizeStyle)({'--chip-color':e.color}),onClick:t=>{return a=e.key,ze.value=a,void Bt('character');var a}},[(0,t.createElementVNode)('span',V,[(0,t.createElementVNode)('img',{id:`avatar-img-${e.key}`,class:'avatar-thumb',src:e.avatarUrl,alt:`${e.name}头像`,loading:'lazy',decoding:'async',onError:t=>ke(t,e.name)},null,40,N)]),(0,t.createElementVNode)('span',k,(0,t.toDisplayString)(e.name),1)],12,f)])),64))])])]),(0,t.createElementVNode)('footer',w,[(0,t.createElementVNode)('button',{id:'btn-toggle-fullscreen',type:'button',class:'btn',title:'全屏',onClick:St},'全屏'),(0,t.createElementVNode)('button',{id:'btn-toggle-autoscroll',type:'button',class:'btn',title:Se.value.autoScroll?'关闭自动滚动':'开启自动滚动',onClick:a[4]||(a[4]=e=>Se.value.autoScroll=!Se.value.autoScroll)},' 自动滚动 ',8,S),(0,t.createElementVNode)('button',{id:'btn-toggle-typewriter',type:'button',class:'btn',title:'切换显示模式',onClick:ut},' 显示模式 '),(0,t.createElementVNode)('button',{id:'btn-open-feature-modal',type:'button',class:'btn',title:'功能面板',onClick:a[5]||(a[5]=e=>Bt('history'))},' 功能面板 ')]),Ce.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',{key:0,id:'layer-feature-modal',role:'dialog','aria-modal':'true','aria-label':'功能面板',class:'modal-scrim',onClick:(0,t.withModifiers)(Dt,['self']),onKeydown:a[26]||(a[26]=e=>$t(e,'layer-feature-modal'))},[(0,t.createElementVNode)('div',C,[(0,t.createElementVNode)('header',{class:'modal-header'},[a[38]||(a[38]=(0,t.createElementVNode)('h2',{id:'modal-feature-title'},'功能面板',-1)),(0,t.createElementVNode)('button',{id:'btn-close-feature-modal',type:'button',class:'btn',onClick:Dt},'关闭')]),(0,t.createElementVNode)('nav',M,[(0,t.createElementVNode)('button',{id:'modal-tab-history',type:'button',class:(0,t.normalizeClass)(['btn',{active:'history'===Me.value}]),onClick:a[6]||(a[6]=e=>Me.value='history')},' 历史消息 ',2),(0,t.createElementVNode)('button',{id:'modal-tab-worldbook',type:'button',class:(0,t.normalizeClass)(['btn',{active:'worldbook'===Me.value}]),onClick:a[7]||(a[7]=e=>Me.value='worldbook')},' 世界书管理 ',2),(0,t.createElementVNode)('button',{id:'modal-tab-settings',type:'button',class:(0,t.normalizeClass)(['btn',{active:'settings'===Me.value}]),onClick:a[8]||(a[8]=e=>Me.value='settings')},' 设置 ',2),(0,t.createElementVNode)('button',{id:'modal-tab-character',type:'button',class:(0,t.normalizeClass)(['btn',{active:'character'===Me.value}]),onClick:a[9]||(a[9]=e=>Me.value='character')},' 角色详情 ',2)]),'history'===Me.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',B,[a[40]||(a[40]=(0,t.createElementVNode)('h3',null,'历史消息',-1)),(0,t.createElementVNode)('div',D,[a[39]||(a[39]=(0,t.createElementVNode)('label',{for:'input-history-search',class:'sr-only'},'搜索历史消息',-1)),(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'input-history-search','onUpdate:modelValue':a[10]||(a[10]=e=>Oe.value=e),type:'search',placeholder:'输入关键字筛选历史消息'},null,512),[[t.vModelText,Oe.value,void 0,{trim:!0}]]),(0,t.createElementVNode)('button',{id:'btn-history-refresh',type:'button',class:'btn',onClick:a[11]||(a[11]=e=>bt(!0))},'刷新')]),(0,t.createElementVNode)('ul',x,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(et.value,e=>{return(0,t.openBlock)(),(0,t.createElementBlock)('li',{key:`history-${e.message_id}`},[(0,t.createElementVNode)('article',{id:`history-item-${e.message_id}`,class:'history-card'},[(0,t.createElementVNode)('header',null,[(0,t.createElementVNode)('span',T,'第'+(0,t.toDisplayString)(e.message_id)+'楼',1),(0,t.createElementVNode)('span',I,(0,t.toDisplayString)((a=e.role,'assistant'===a?'助手':'user'===a?'玩家':'系统')),1),(0,t.createElementVNode)('span',L,(0,t.toDisplayString)(e.name||'未知角色'),1)]),(0,t.createElementVNode)('p',null,(0,t.toDisplayString)(Ne(e.message,160)),1),(0,t.createElementVNode)('button',{id:`btn-history-use-${e.message_id}`,type:'button',class:'btn panel-mini-btn',onClick:t=>{return a=e.message,xe.value=a,Dt(),void toastr.info('已将历史消息填入自定义选项输入框。');var a}},' 引用到自定义选项 ',8,A)],8,U)]);var a}),128))]),(0,t.createElementVNode)('div',R,[(0,t.createElementVNode)('button',{id:'btn-history-load-more',type:'button',class:'btn',disabled:!tt.value,onClick:gt},' 加载更多 ',8,F)])])):'worldbook'===Me.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',O,[a[43]||(a[43]=(0,t.createElementVNode)('h3',null,'世界书管理',-1)),(0,t.createElementVNode)('div',W,[a[41]||(a[41]=(0,t.createElementVNode)('label',{for:'select-worldbook',class:'sr-only'},'选择世界书',-1)),(0,t.withDirectives)((0,t.createElementVNode)('select',{id:'select-worldbook','onUpdate:modelValue':a[12]||(a[12]=e=>qe.value=e)},[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(We.value,e=>((0,t.openBlock)(),(0,t.createElementBlock)('option',{key:e,value:e},(0,t.toDisplayString)(e),9,q))),128))],512),[[t.vModelSelect,qe.value]]),a[42]||(a[42]=(0,t.createElementVNode)('label',{for:'input-worldbook-search',class:'sr-only'},'搜索世界书条目',-1)),(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'input-worldbook-search','onUpdate:modelValue':a[13]||(a[13]=e=>Ge.value=e),type:'search',placeholder:'搜索条目名称或内容'},null,512),[[t.vModelText,Ge.value,void 0,{trim:!0}]]),(0,t.createElementVNode)('button',{id:'btn-worldbook-refresh',type:'button',class:'btn',onClick:Et},'刷新')]),He.value?((0,t.openBlock)(),(0,t.createElementBlock)('p',j,(0,t.toDisplayString)(He.value),1)):Ke.value?((0,t.openBlock)(),(0,t.createElementBlock)('p',G,'世界书读取中...')):(0,t.createCommentVNode)('v-if',!0),(0,t.createElementVNode)('ul',H,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(at.value,e=>((0,t.openBlock)(),(0,t.createElementBlock)('li',{key:e.uid},[(0,t.createElementVNode)('article',{id:`worldbook-entry-${e.uid}`,class:'worldbook-card'},[(0,t.createElementVNode)('header',null,[(0,t.createElementVNode)('strong',null,(0,t.toDisplayString)(e.name||`未命名条目-${e.uid}`),1),(0,t.createElementVNode)('button',{id:`btn-worldbook-toggle-${e.uid}`,type:'button',class:'btn panel-mini-btn',onClick:t=>async function(e,t){if(qe.value)try{je.value=await updateWorldbookWith(qe.value,a=>a.map(a=>a.uid!==e?a:{...a,enabled:t}))}catch(e){toastr.error('世界书条目状态更新失败。'),console.error(e)}}(e.uid,!e.enabled)},(0,t.toDisplayString)(e.enabled?'已启用':'已禁用'),9,P)]),(0,t.createElementVNode)('p',null,(0,t.toDisplayString)(Ne(e.content,120)),1),(0,t.createElementVNode)('div',J,[(0,t.createElementVNode)('span',null,'策略：'+(0,t.toDisplayString)(e.strategy.type),1),(0,t.createElementVNode)('span',null,'概率：'+(0,t.toDisplayString)(e.probability)+'%',1)])],8,K)]))),128))])])):'settings'===Me.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',Q,[a[58]||(a[58]=(0,t.createElementVNode)('h3',null,'设置',-1)),(0,t.createElementVNode)('form',{id:'form-ui-settings',class:'settings-grid',onSubmit:a[24]||(a[24]=(0,t.withModifiers)(()=>{},['prevent']))},[(0,t.createElementVNode)('fieldset',X,[a[46]||(a[46]=(0,t.createElementVNode)('legend',null,'主题风格',-1)),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-theme-latte','onUpdate:modelValue':a[14]||(a[14]=e=>Se.value.theme=e),type:'radio',value:'theme-latte-noir'},null,512),[[t.vModelRadio,Se.value.theme]]),a[44]||(a[44]=(0,t.createTextVNode)(' 奶油白昼 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-theme-midnight','onUpdate:modelValue':a[15]||(a[15]=e=>Se.value.theme=e),type:'radio',value:'theme-midnight-salon'},null,512),[[t.vModelRadio,Se.value.theme]]),a[45]||(a[45]=(0,t.createTextVNode)(' 午夜沙龙 ',-1))])]),(0,t.createElementVNode)('fieldset',Y,[a[50]||(a[50]=(0,t.createElementVNode)('legend',null,'消息显示',-1)),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-mode-instant','onUpdate:modelValue':a[16]||(a[16]=e=>Se.value.displayMode=e),type:'radio',value:'instant'},null,512),[[t.vModelRadio,Se.value.displayMode]]),a[47]||(a[47]=(0,t.createTextVNode)(' 即时显示 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-mode-typewriter','onUpdate:modelValue':a[17]||(a[17]=e=>Se.value.displayMode=e),type:'radio',value:'typewriter'},null,512),[[t.vModelRadio,Se.value.displayMode]]),a[48]||(a[48]=(0,t.createTextVNode)(' 打字机 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-mode-segment','onUpdate:modelValue':a[18]||(a[18]=e=>Se.value.displayMode=e),type:'radio',value:'segment'},null,512),[[t.vModelRadio,Se.value.displayMode]]),a[49]||(a[49]=(0,t.createTextVNode)(' 分段显示 ',-1))])]),(0,t.createElementVNode)('fieldset',Z,[a[54]||(a[54]=(0,t.createElementVNode)('legend',null,'字体大小',-1)),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-font-small','onUpdate:modelValue':a[19]||(a[19]=e=>Se.value.fontScale=e),type:'radio',value:'small'},null,512),[[t.vModelRadio,Se.value.fontScale]]),a[51]||(a[51]=(0,t.createTextVNode)(' 小 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-font-medium','onUpdate:modelValue':a[20]||(a[20]=e=>Se.value.fontScale=e),type:'radio',value:'medium'},null,512),[[t.vModelRadio,Se.value.fontScale]]),a[52]||(a[52]=(0,t.createTextVNode)(' 中 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'radio-font-large','onUpdate:modelValue':a[21]||(a[21]=e=>Se.value.fontScale=e),type:'radio',value:'large'},null,512),[[t.vModelRadio,Se.value.fontScale]]),a[53]||(a[53]=(0,t.createTextVNode)(' 大 ',-1))])]),(0,t.createElementVNode)('fieldset',ee,[a[57]||(a[57]=(0,t.createElementVNode)('legend',null,'交互偏好',-1)),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'check-auto-scroll','onUpdate:modelValue':a[22]||(a[22]=e=>Se.value.autoScroll=e),type:'checkbox'},null,512),[[t.vModelCheckbox,Se.value.autoScroll]]),a[55]||(a[55]=(0,t.createTextVNode)(' 自动滚动 ',-1))]),(0,t.createElementVNode)('label',null,[(0,t.withDirectives)((0,t.createElementVNode)('input',{id:'check-reduced-motion','onUpdate:modelValue':a[23]||(a[23]=e=>Se.value.reduceMotion=e),type:'checkbox'},null,512),[[t.vModelCheckbox,Se.value.reduceMotion]]),a[56]||(a[56]=(0,t.createTextVNode)(' 减少动效 ',-1))])])],32),(0,t.createElementVNode)('div',{class:'panel-actions-row'},[(0,t.createElementVNode)('button',{id:'btn-reset-settings',type:'button',class:'btn',onClick:dt},'重置默认设置')])])):((0,t.openBlock)(),(0,t.createElementBlock)('section',te,[a[63]||(a[63]=(0,t.createElementVNode)('h3',null,'角色详情',-1)),(0,t.createElementVNode)('div',ae,[(0,t.createElementVNode)('ul',le,[((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(fe,e=>(0,t.createElementVNode)('li',{key:`detail-${e.key}`},[(0,t.createElementVNode)('button',{id:`btn-character-focus-${e.key}`,type:'button',class:(0,t.normalizeClass)(['btn',{active:ze.value===e.key}]),onClick:t=>ze.value=e.key},(0,t.toDisplayString)(e.name),11,ne)])),64))]),(0,t.createElementVNode)('article',oe,[(0,t.createElementVNode)('div',re,[(0,t.createElementVNode)('img',{id:'img-character-detail',src:lt.value.avatarUrl,alt:`${lt.value.name}立绘`,loading:'lazy',decoding:'async',onError:a[25]||(a[25]=e=>ke(e,lt.value.name))},null,40,ie)]),(0,t.createElementVNode)('h4',null,(0,t.toDisplayString)(lt.value.name),1),(0,t.createElementVNode)('p',null,(0,t.toDisplayString)(lt.value.summary),1),(0,t.createElementVNode)('dl',null,[a[59]||(a[59]=(0,t.createElementVNode)('dt',null,'心情',-1)),(0,t.createElementVNode)('dd',null,(0,t.toDisplayString)(nt.value.mood),1),a[60]||(a[60]=(0,t.createElementVNode)('dt',null,'位置',-1)),(0,t.createElementVNode)('dd',null,(0,t.toDisplayString)(nt.value.location),1),a[61]||(a[61]=(0,t.createElementVNode)('dt',null,'着装',-1)),(0,t.createElementVNode)('dd',null,(0,t.toDisplayString)(nt.value.outfit),1),a[62]||(a[62]=(0,t.createElementVNode)('dt',null,'关系',-1)),(0,t.createElementVNode)('dd',null,(0,t.toDisplayString)(nt.value.relation),1)])])])]))])],32)):(0,t.createCommentVNode)('v-if',!0),Be.value?((0,t.openBlock)(),(0,t.createElementBlock)('section',{key:1,id:'layer-perspective-modal',role:'dialog','aria-modal':'true','aria-label':'主视角选择',class:'modal-scrim perspective',onKeydown:a[27]||(a[27]=e=>$t(e,'layer-perspective-modal'))},[(0,t.createElementVNode)('div',ce,[a[65]||(a[65]=(0,t.createElementVNode)('header',{class:'modal-header'},[(0,t.createElementVNode)('h2',{id:'heading-perspective-selector'},'请选择主视角')],-1)),a[66]||(a[66]=(0,t.createElementVNode)('p',{class:'perspective-tip'},'首次进入当前聊天且最高楼层为0时，需要先选择主视角后再发送行动。',-1)),(0,t.createElementVNode)('ul',se,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Ye.value,e=>((0,t.openBlock)(),(0,t.createElementBlock)('li',{key:e.key},[(0,t.createElementVNode)('button',{id:`btn-select-perspective-${e.key}`,type:'button',class:(0,t.normalizeClass)(['btn perspective-card',{active:$e.value===e.key}]),onClick:t=>$e.value=e.key},[(0,t.createElementVNode)('strong',null,(0,t.toDisplayString)(e.key),1),(0,t.createElementVNode)('span',null,(0,t.toDisplayString)(e.description),1)],10,de)]))),128))]),(0,t.createElementVNode)('div',ue,[a[64]||(a[64]=(0,t.createElementVNode)('h3',{id:'heading-opening-preview'},'开场白预览',-1)),(0,t.createElementVNode)('p',me,(0,t.toDisplayString)(Ze.value),1)]),(0,t.createElementVNode)('button',{id:'btn-confirm-perspective',type:'button',class:'btn confirm-btn',disabled:!$e.value,onClick:yt},' 确认主视角 ',8,pe)])],32)):(0,t.createCommentVNode)('v-if',!0)],12,l))}});$(()=>{const a=(0,t.createApp)(be).use(e());a.mount('#app'),$(window).on('pagehide',()=>a.unmount())});
//# sourceMappingURL=index.js.map</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;600;700&family=Noto+Serif+SC:wght@400;600&family=ZCOOL+XiaoWei&display=swap);
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css);
/*! tailwindcss v4.2.0 | MIT License | https://tailwindcss.com */:root{--clr-cocoa:#f5b0b6;--clr-chino:#8ab7eb;--clr-rize:#ae96d8;--clr-chiya:#87ce87;--clr-syaro:#f5d36e;--clr-maya:#7dd4df;--clr-megu:#f7a699;--clr-fuyu:#8d8fd6;--clr-yura:#e58ec4;--clr-natsume:#ce67e8;--clr-eru:#faa548;--clr-aoyama:#4778d1;--clr-mate:#4bafd7;--clr-mocha:#b7df69}:root{--bg-0:hsl(28 34% 97%);--bg-1:hsl(26 38% 93%);--bg-2:hsl(20 24% 88%);--ink-0:hsl(290 12% 16%);--ink-1:hsl(292 9% 32%);--line-soft:hsl(25 24% 82%/0.9);--shadow-soft:0 12px 32px hsl(290 18% 22%/0.12);--shadow-float:0 20px 44px hsl(285 22% 20%/0.18);--surface-main:linear-gradient(160deg,hsl(30 36% 97%),hsl(23 42% 92%));--accent-rose:hsl(341 46% 66%);--accent-violet:hsl(267 33% 63%);--dur-fast:140ms;--dur-mid:220ms;--ease-out:cubic-bezier(0.2,0.8,0.2,1);--decor-gold:#c9a86c;--decor-rose:#e8c4c4}[data-theme='theme-midnight-salon']{--bg-0:hsl(262 23% 12%);--bg-1:hsl(264 20% 16%);--ink-0:hsl(30 30% 94%);--ink-1:hsl(280 16% 84%);--line-soft:hsl(266 14% 36%/0.8);--surface-main:linear-gradient(160deg,hsl(262 24% 14%),hsl(279 20% 18%));--accent-rose:hsl(341 40% 50%);--accent-violet:hsl(267 30% 50%)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.animate-fadeIn{animation:fadeIn var(--dur-mid) ease forwards}.animate-fadeInUp{animation:fadeInUp var(--dur-mid) ease forwards}.animate-fadeInDown{animation:fadeInDown var(--dur-mid) ease forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.fade-enter-active,.fade-leave-active{transition:opacity 0.5s ease}.fade-enter-from,.fade-leave-to{opacity:0}*{box-sizing:border-box}html,body,#app{margin:0;padding:0;width:100%;height:100%}body{font-family:'Noto Sans SC',sans-serif;color:var(--ink-0);background:var(--bg-0);overflow:hidden}#page-game-root{width:100%;height:100%;display:flex;flex-direction:column;position:relative;background:transparent;font-size:calc(16px * var(--font-scale,1))}.background-layer{position:fixed;inset:0;z-index:-1;background:var(--bg-0);overflow:hidden}.bg-gradient{position:absolute;inset:0;background:radial-gradient(circle at 20% 30%,var(--accent-rose),transparent 40%),radial-gradient(circle at 80% 70%,var(--accent-violet),transparent 40%);@supports (color:color-mix(in lab,red,red)){background:radial-gradient(circle at 20% 30%,color-mix(in oklab,var(--accent-rose) 10%,transparent),transparent 40%),radial-gradient(circle at 80% 70%,color-mix(in oklab,var(--accent-violet) 10%,transparent),transparent 40%)}}.splash-screen{position:fixed;inset:0;z-index:100;background:var(--bg-0);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:40px}.splash-logo{text-align:center}.splash-title{font-family:'ZCOOL XiaoWei',serif;font-size:3rem;background:linear-gradient(120deg,var(--accent-rose),var(--accent-violet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}.splash-subtitle{font-size:1.2rem;color:var(--ink-1);letter-spacing:4px}.press-start-btn{padding:12px 48px;font-size:1.5rem;font-weight:700;color:white;background:linear-gradient(120deg,var(--accent-rose),var(--accent-violet));border:none;border-radius:999px;cursor:pointer;box-shadow:0 10px 20px var(--accent-rose);@supports (color:color-mix(in lab,red,red)){box-shadow:0 10px 20px color-mix(in oklab,var(--accent-rose) 30%,transparent)}transition:transform 0.2s,box-shadow 0.2s}.press-start-btn:hover{transform:scale(1.05);box-shadow:0 15px 30px var(--accent-rose);@supports (color:color-mix(in lab,red,red)){box-shadow:0 15px 30px color-mix(in oklab,var(--accent-rose) 40%,transparent)}}#region-top-nav{padding:16px 24px;background:hsl(0 0% 100%/0.4);backdrop-filter:blur(10px);border-bottom:1px solid var(--line-soft);margin-bottom:0;z-index:10}#region-main-content{flex:1;display:grid;grid-template-columns:1fr 320px;grid-template-rows:1fr auto;gap:20px;padding:20px;overflow:hidden;max-width:1400px;margin:0 auto;width:100%}.panel-story{grid-column:1;grid-row:1;display:flex;flex-direction:column;overflow:hidden}#story-current-message{flex:1;overflow-y:auto;padding:10px;font-size:1.1em}.panel-options{grid-column:1;grid-row:2}.panel-characters{grid-column:2;grid-row:1/span 2;display:flex;flex-direction:column}.avatar-list{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:12px;padding-right:4px}.avatar-chip{width:100%;justify-content:flex-start;padding:10px}#region-quick-actions{position:fixed;left:20px;bottom:20px;display:flex;flex-direction:column;gap:10px;z-index:20;background:transparent;box-shadow:none;padding:0;margin:0}.quick-actions .btn{width:44px;height:44px;padding:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0}.quick-actions .btn::before{font-family:'Font Awesome 6 Free';font-weight:900;font-size:16px}#btn-toggle-fullscreen::before{content:'\f065'}#btn-toggle-autoscroll::before{content:'\f337'}#btn-toggle-typewriter::before{content:'\f11c'}#btn-open-feature-modal::before{content:'\f0ad'}@media (max-width:1000px){#region-main-content{grid-template-columns:1fr;grid-template-rows:1fr auto auto}.panel-characters{grid-column:1;grid-row:3}.avatar-list{flex-direction:row;flex-wrap:wrap}.avatar-chip{width:auto}}.modal-scrim{position:fixed;inset:0;z-index:30;background:hsl(280 30% 8%/0.4);display:flex;align-items:flex-end;justify-content:center;padding:0}.modal-shell{width:100%;max-height:86dvh;overflow:auto;border-radius:16px 16px 0 0;border:1px solid var(--line-soft);background:var(--surface-main);box-shadow:var(--shadow-float);animation:modal-enter var(--dur-mid) var(--ease-out)}.modal-header{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:12px;border-bottom:1px solid var(--line-soft)}.tab-nav{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:8px;padding:12px}.tab-nav .active{color:white;border-color:transparent;background:linear-gradient(120deg,var(--accent-rose),var(--accent-violet))}.tab-panel{padding:0 12px 12px}.panel-tools{display:grid;grid-template-columns:1fr auto;gap:8px;margin-bottom:10px}.panel-tools input,.panel-tools select{border:1px solid var(--line-soft);border-radius:10px;background:hsl(0 0% 100%/0.85);color:var(--ink-0);padding:8px 10px}.history-list,.worldbook-list,.character-selector{list-style:none;margin:0;padding:0}.history-list,.worldbook-list{display:grid;gap:8px}.history-card,.worldbook-card,.character-detail-card{border:1px solid var(--line-soft);border-radius:12px;background:hsl(0 0% 100%/0.62);padding:10px}.history-card>header,.worldbook-card>header{display:flex;align-items:center;flex-wrap:wrap;gap:6px;margin-bottom:6px}.badge{display:inline-flex;align-items:center;border-radius:999px;border:1px solid var(--line-soft);padding:2px 8px;font-size:0.84em;background:hsl(0 0% 100%/0.9)}.badge.muted{color:var(--ink-1)}.panel-actions-row{display:flex;justify-content:flex-end;margin-top:10px}.entry-meta{margin-top:8px;display:flex;gap:12px;color:var(--ink-1);font-size:0.88em}.inline-error{color:hsl(357 66% 42%);margin:0 0 8px}.inline-tip{color:var(--ink-1);margin:0 0 8px}.settings-grid{display:grid;gap:10px}.setting-group{border:1px solid var(--line-soft);border-radius:12px;padding:10px;display:grid;gap:8px}.setting-group legend{font-weight:600;padding:0 4px}.setting-group label{display:inline-flex;align-items:center;gap:6px}.character-panel{display:grid;gap:10px}.character-selector{display:flex;flex-wrap:wrap;gap:8px}.character-selector .active{color:white;border-color:transparent;background:linear-gradient(120deg,var(--accent-rose),var(--accent-violet))}.character-detail-card dl{display:grid;grid-template-columns:auto 1fr;gap:6px 10px;margin:0}.character-hero{margin:-2px -2px 8px;border-radius:10px;overflow:hidden;border:1px solid var(--line-soft);max-height:188px}.character-hero img{width:100%;height:100%;max-height:188px;object-fit:cover;display:block}.character-detail-card dt{color:var(--ink-1)}.character-detail-card dd{margin:0}.perspective{align-items:center}.perspective-shell{border-radius:16px;width:min(100%,720px);max-height:88dvh}.perspective-tip{padding:0 12px;color:var(--ink-1)}.opening-preview-wrap{margin:0 12px 12px;padding:10px;border-radius:10px;border:1px solid var(--line-soft);background:hsl(0 0% 100%/0.62)}#heading-opening-preview{margin:0 0 8px;font-size:1em}#text-opening-preview{margin:0;line-height:1.65}.perspective-list{list-style:none;margin:0;padding:12px;display:grid;gap:8px}.perspective-card{width:100%;text-align:left;padding:10px;display:grid;gap:4px}.perspective-card.active{border-color:transparent;color:white;background:linear-gradient(120deg,var(--accent-rose),var(--accent-violet))}.confirm-btn{margin:0 12px 12px;width:calc(100% - 24px);padding:10px}@keyframes modal-enter{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (min-width:1024px){.modal-scrim{align-items:center;padding:20px}.modal-shell{width:min(100%,860px);border-radius:18px;max-height:min(85dvh,760px)}#region-main-content{grid-template-columns:1.3fr 1fr}.panel-story{grid-column:1/2;grid-row:1/3}.panel-tools{grid-template-columns:1fr 1fr auto}}@media (prefers-reduced-motion:reduce){*{animation:none !important;transition:none !important}}[data-reduced-motion='true'] *{animation:none !important;transition:none !important}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>